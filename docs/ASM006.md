## Sample Program ASM006

### Source

DWALL01.DEV.SORLIB(ASM006) writes a record to a new GDG generation.

ASM006 extends the object-oriented concepts introduced in ASM005. Here, we add a @LOG class that inherits the @FIL class. The $LOG DSECT maps storage allocated by @LOGA. A @LOG class allocates its own underlying $FIL instance and calls @FIL methods to perform lower-level QSAM I/O through calls to the DCB's I/O routine. The @LOGW method "extends" the @FILW method, including additional information in the output record, notably the current date and time.
```
***********************************************************************
*
*        PROGRAM    ASM006
*
*        THIS PROGRAM WRITES A RECORD TO A DATA SET. A REUSABLE @LOG
*        CLASS IS PLACED IN A COPY BOOK MEMBER. @LOG INHERITS FROM, OR
*        EXTENDS, THE @FIL CLASS. @LOG ADDS DATE AND TIME INFORMATION
*        TO THE MESSAGE WRITTEN TO THE DATA SET.
*
*        ENTRY      R1      PROGRAM ARGUMENTS ADDRESS
*                   R13     CALLER SAVE AREA ADDRESS
*                   R14     RETURN ADDRESS
*                   R15     CONTROL SECTION ADDRESS
*
*        EXIT       R14     RETURN ADDRESS
*                   R15     RESULT CODE
*
***********************************************************************
         EJECT
***********************************************************************
*
*        @PGM       PROGRAM CONTROL SECTION
*
***********************************************************************
         SPACE
@PGM     CSECT                          PROGRAM ENTRY
         SPACE
         USING @PGM,R12
         USING $PGM,R13
         SPACE
         STM   R14,R12,12(R13)          SAVE CALLER REGS
         LR    R12,R15                  @PGM BASE
         SPACE
         LA    R0,E$PGML                LENGTH OF STORAGE
         SPACE
         GETMAIN R,LV=(0)               GET STORAGE ADDR IN REG 1
         SPACE
         LR    R14,R1                   $PGM ADDR
         LA    R15,E$PGML               $PGM SIZE
         XR    R2,R2                    SOURCE ADDR (NO COPY)
         LR    R3,R2                    SOURCE LENGTH (PAD)
         MVCL  R14,R2                   CLEAR STORAGE TO ZEROS
         SPACE
         ST    R13,4(,R1)               SAVE PARENT SAVE AREA ADDR
         ST    R1,8(,R13)               SAVE CURRENT SAVE AREA ADDR
         LR    R13,R1                   LOAD SAVE AREA ADDR
         SPACE
         BAL   R14,@INIT                INITIALIZE PROGRAM
         SPACE
         LTR   R15,R15                  IF INITIALIZATION SUCCEEDED
         BNZ   @PGM10
         SPACE
         BAL   R14,@MAIN                  DO MAINLINE LOGIC
         SPACE
@PGM10   DS    0H                       END IF
         SPACE
         BAL   R14,@FINAL               FINALIZE PROGRAM
         SPACE
         LR    R2,R15                   HOLD RESULT CODE
         SPACE
         LA    R0,E$PGML                LENGTH OF STORAGE
         LR    R1,R13                   SAVE AREA ADDR
         L     R13,4(,R1)               RESTORE PARENT SAVEAREA ADDR
         SPACE
         FREEMAIN R,LV=(R0),A=(R1)      RELEASE STORAGE
         SPACE
         LR    R15,R2                   RESULT CODE
         SPACE
         LM    R0,R12,20(R13)           LOAD CALLER REGS
         L     R14,12(,R13)             LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13
         EJECT
***********************************************************************
*
*        @INIT      INITIALIZE PROGRAM
*
***********************************************************************
         SPACE
@INIT    DS    0H
         SPACE
         USING @PGM,R12
         USING $PGM,R13
         USING @LOG,R10
         SPACE
         ST    R14,PGM$I                SAVE RETURN ADDR (,13)
         SPACE
         L     R10,PGM@LOG              @LOG ADDR (,12)
         BAL   R14,@LOGA                ALLOCATE $LOG (,10)
         SPACE
         ST    R1,PGM$LOG               SAVE $LOG ADDR (,13)
         SPACE
         WTO   '@LOGA OK'               NOTIFY CONSOLE
         SPACE
         LA    R1,DCBLOG                LOG DCB ADDR (,12)
         L     R10,PGM@LOG              @LOG ADDR (,12)
         L     R11,PGM$LOG              $LOG ADDR (,13)
         BAL   R14,@LOGI                INITIALIZE $LOG (,10)
         SPACE
         WTO   '@LOGI OK'               NOTIFY CONSOLE
         SPACE
         L     R10,PGM@LOG              @LOG ADDR (,12)
         L     R11,PGM$LOG              $LOG ADDR (,13)
         BAL   R14,@LOGO                OPEN LOG FILE (,10)
         SPACE
         LTR   R15,R15                  IF FILE OPEN
         BNZ   @INIT10
         SPACE
         WTO   '@LOGO OK'                 NOTIFY CONSOLE
         SPACE
         XR    R15,R15                    ZERO RESULT CODE
         SPACE
@INIT10  DS    0H                       END IF
         SPACE
         L     R14,PGM$I                LOAD RETURN ADDR (,13)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @MAIN      MAIN LOGIC LOOP
*
***********************************************************************
         SPACE
@MAIN    DS    0H
         SPACE
         USING @PGM,R12
         USING $PGM,R13
         USING @LOG,R10
         SPACE
         ST    R14,PGM$M                SAVE RETURN ADDR
         SPACE
         LA    R0,L'CCLOGMSG            MESSAGE SIZE
         LA    R1,CCLOGMSG              MESSAGE ADDR (,12)
         L     R10,PGM@LOG              @LOG ADDR (,12)
         L     R11,PGM$LOG              $LOG ADDR (,13)
         BAL   R14,@LOGW                WRITE MESSAGE
         SPACE
         LTR   R15,R15                  IF RECORD WRITTEN
         BNZ   @MAIN10
         SPACE
         WTO   '@LOGW OK'                 NOTIFY CONSOLE
         SPACE
@MAIN10  DS    0H                       END IF
         SPACE
         L     R14,PGM$M                LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @FINAL     FINALIZATION ROUTINE
*
***********************************************************************
         SPACE
@FINAL   DS    0H
         SPACE
         USING @PGM,R12
         USING $PGM,R13
         USING @LOG,R10
         SPACE
         ST    R14,PGM$F                SAVE RETURN ADDR
         SPACE
         L     R10,PGM@LOG              @LOG ADDR (,12)
         L     R11,PGM$LOG              $LOG ADDR (,13)
         BAL   R14,@LOGC                CLOSE LOG FILE (,10)
         SPACE
         LTR   R15,R15                  IF FILE CLOSED
         BNZ   @FINL10
         SPACE
         WTO   '@LOGC OK'                 NOTIFY CONSOLE
         SPACE
@FINL10  DS    0H                       END IF
         SPACE
         L     R10,PGM@LOG              @LOG ADDR (,12)
         L     R11,PGM$LOG              $LOG ADDR (,13)
         BAL   R14,@LOGZ                RELEASE LOG (,10)
         SPACE
         WTO   '@LOGZ OK'               NOTIFY CONSOLE
         SPACE
         XR    R15,R15                  ZERO RESULT CODE
         SPACE
         L     R14,PGM$F                LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        W O R K I N G   S T O R A G E
*
***********************************************************************
         SPACE
         COPY  EREGS
         SPACE
PGM@LOG  DC    A(@LOG)                  @LOG ADDR
         SPACE
CCLOGMSG DC    C'LOG MESSAGE'
         SPACE
DCBLOG   DCB   DDNAME=LOG,DSORG=PS,RECFM=FB,                           X
               LRECL=80,MACRF=(PM),SYNAD=@FILWSYN
         EJECT
         LTORG
         EJECT
***********************************************************************
*
*        $PGM       PROGRAM DATA SECTION
*
***********************************************************************
         SPACE
$PGM     DSECT
         SPACE
         DS    18F                      REGISTER SAVE AREA
         SPACE
PGM$I    DS    F                        @INIT RETURN ADDR
PGM$M    DS    F                        @MAIN RETURN ADDR
PGM$F    DS    F                        @FINAL RETURN ADDR
         SPACE
PGM$LOG  DS    F                        $LOG ADDR
         SPACE
E$PGML   EQU   *-$PGM                   SIZE OF SAVE AREA
         SPACE
         EJECT
***********************************************************************
*
*        INCLUDED OBJECTS
*
***********************************************************************
         SPACE
         COPY  @LOG                     LOG CLASS
         COPY  @FIL                     FILE CLASS
         END   @PGM                     END OF PROGRAM
```

### Copy Book @LOG

DWALL01.DEV.MACLIB(@LOG) implements the methods of the @LOG class, each instance of which is a reference the $LOG DSECT in allocated storage.
```
***********************************************************************
*
*        @LOG       LOG FACILITY
*
*        @LOGA      ALLOCATE STORAGE FOR $LOG INSTANCE
*        @LOGI      INITIALIZE INSTANCE
*        @LOGO      OPEN THE FILE
*        @LOGR      READ FROM THE FILE
*        @LOGW      WRITE TO THE FILE
*        @LOGC      CLOSE THE FILE
*        @LOGZ      FINALIZE THE $LOG INSTANCE
*
*        COPYRIGHT 2010-2021 DAVID J WALLING. MIT LICENSE.
*
***********************************************************************
         EJECT
***********************************************************************
*
*        @LOG       LOG CONTROL SECTION
*
***********************************************************************
         SPACE
@LOG     CSECT
         EJECT
***********************************************************************
*
*        @LOGA      ALLOCATE STORAGE FOR INSTANCE
*
*        IN         R10     @LOG CSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDR
*
*        OUT        R1      $LOG ADDR (OR ABEND)
*                   R15     GETMAIN RESULT (OR ABEND)
*
***********************************************************************
         SPACE
@LOGA    DS    0H
         SPACE
         USING @LOG,R10
         SPACE
         LR    R2,R14                   HOLD RETURN ADDR
         LA    R0,E$LOGL                $LOG SIZE
         SPACE
         GETMAIN R,LV=(0)               ALLOCATE STORAGE (,10)
         SPACE
         LR    R14,R2                   LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R10
         EJECT
***********************************************************************
*
*        @LOGI      INITIALIZE $LOG CONTEXT
*
*        IN         R1      DCB TEMPLATE ADDR
*                   R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER CODE
*                   R13     CALLER DATA
*                   R14     RETURN ADDR
*
***********************************************************************
         SPACE
@LOGI    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$I            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$I            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         USING @FIL,R10
         SPACE
         ST    R1,LOG$DCB               SAVE DCB TEMPLATE ADDR (,13)
         SPACE
         MVI   LOGWCDL1,C'.'            DELIMITER 1
         MVI   LOGWCDL2,C'.'            DELIMITER 2
         MVI   LOGWCDL3,C' '            DELIMITER 3
         MVI   LOGWCDL4,C':'            DELIMITER 4
         MVI   LOGWCDL5,C':'            DELIMITER 5
         MVI   LOGWCDL6,C' '            DELIMITER 6
         SPACE
         L     R10,LOG@FIL              @FIL BASE (,12)
         BAL   R14,@FILA                ALLOCATE $FIL (,10)
         SPACE
         ST    R1,LOG$FIL               SAVE $FIL ADDR (,13)
         SPACE
         LA    R0,FILETYPO              DCB OPTION BYTE FOR LOG
         L     R1,LOG$DCB               DCB TEMPLATE FOR LOG (,13)
         L     R10,LOG@FIL              @FIL BASE (,12)
         L     R11,LOG$FIL              $FIL BASE (,13)
         BAL   R14,@FILI                INITIALIZE $FIL (,10)
         SPACE
         LM    R10,R14,LOG$I            LOAD CALLER LINKAGE (,13)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @LOGO      OPEN LOG
*
*        IN         R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER CODE
*                   R13     CALLER SAVE AREA
*                   R14     RETURN ADDR
*
*        OUT        R15     RESULT CODE
*
***********************************************************************
         SPACE
@LOGO    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$O            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$O            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         USING @FIL,R10
         SPACE
         L     R10,LOG@FIL              @FIL ADDR (,12)
         L     R11,LOG$FIL              $FIL ADDR (,13)
         BAL   R14,@FILO                OPEN $FIL (,10)
         SPACE
         SPACE
         LM    R10,R14,LOG$O            LOAD CALLER LINKAGE (,13)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @LOGT      GET CURRENT DATE TIME AND CONVERT
*
*        UPDATE THE DATE AND TIME IN THE LOG OUPUT RECORD IF THE
*        CURRENT DATE AND TIME HAVE CHANGED.
*
*        IN         R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER ADDR
*                   R13     CALLER SAVE AREA
*                   R14     RETURN ADDR
*
*        OUT        R15     RESULT CODE
*
***********************************************************************
         SPACE
@LOGT    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$T            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$T            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         SPACE
         TIME  ZONE=LT                  R0,R1 = 0HHMMSST YYYYJJJZ
         SPACE
         STM   R0,R1,LOGWPDBL           STORE PACKED TIME AND DATE
         UNPK  LOGWCWRK,LOGWPDBL        ZONE DECIMAL TIME AND DATE
         SPACE
         MVC   LOGWCHRS,LOGWCWRK+1      STORE HOUR
         MVC   LOGWCMIN,LOGWCWRK+3      STORE MINUTE
         MVC   LOGWCSEC,LOGWCWRK+5      STORE SECOND
         SPACE
         C     R1,LOGWFDAT              IF DATE HAS CHANGED
         BE    @LOGT40
         SPACE
         ST    R1,LOGWFDAT                UPDATE SAVED DATE
         SPACE
         XR    R0,R0                      00000000 YYYYJJJ+
         SRL   R1,12                      00000000 000YYYYJ
         O     R1,LOGCF15                 00000000 000YYYYF
         SPACE
         STM   R0,R1,LOGWPDBL             STORE ERA AND YEAR
         AP    LOGWPDBL,LOGCPERA          PACKED YEAR
         UNPK  LOGWCYRS,LOGWPDBL          ZONED DECIMAL YEAR
         OI    LOGWCYRS+(L'LOGWCYRS-1),X'F0'
         SPACE
         CVB   R1,LOGWPDBL                00000000 0000YYYY
         STH   R1,LOGWHYRS                STORE BINARY YEAR
         ICM   R1,B'0011',LOGWFDAT+2      00000000 0000JJJ+
         STM   R0,R1,LOGWPDBL             STORE DECIMAL JULIAN DAY
         CVB   R1,LOGWPDBL                00000000 00000JJJ
         EJECT
         LA    R3,LOGCTMON                TABLE OF MONTHS
         TM    LOGWHYRS+1,X'03'           IF YEAR MOD 4 IS ZERO
         BNZ   @LOGT10                      AND
         CLC   LOGWCYRS+2,LOGCC00         IF NOT CENTURY MARK
         BE    @LOGT10
         LA    R3,2(,R3)                    LEAP-DAY TABLE OFFSET
         SPACE
@LOGT10  DS    0H                         END IF
         SPACE
         LA    R0,12                      MONTHS PER YEAR
         XR    R2,R2                      ZERO TABLE INDEX
         SPACE
@LOGT20  DS    0H                         WHILE DAY > MAX DAY(MONTH)
         SPACE
         CH    R1,0(R2,R3)
         BNH   @LOGT30
         SH    R1,0(R2,R3)                  SUBTRACT MAX DAY(MONTH)
         LA    R2,16(,R2)                   POINT TO NEXT ELEMENT
         BCT   R0,@LOGT20
         SPACE
@LOGT30  DS    0H                         END DO
         SPACE
         SRL   R2,4                       CONVERT OFFSET TO INDEX
         LA    R2,1(,R2)                  MONTH (1-12)
         SPACE
         CVD   R2,LOGWPDBL                PACKED MONTH
         UNPK  LOGWCMON,LOGWPDBL          ZONED DECIMAL
         OI    LOGWCMON+(L'LOGWCMON-1),X'F0'
         SPACE
         CVD   R1,LOGWPDBL                PACKED DAY (1-31)
         UNPK  LOGWCMDY,LOGWPDBL          ZONED DECIMAL
         OI    LOGWCMDY+(L'LOGWCMDY-1),X'F0'
         SPACE
@LOGT40  DS    0H                       END IF
         SPACE
         LM    R10,R14,LOG$T            LOAD CALLER LINKAGE
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13
         EJECT
***********************************************************************
*
*        @LOGW      WRITE MESSAGE TO LOG FILE
*
*        TRUNCATE MESSAGE IF TOO LONG. SETUP DATE AND TIME IN LOG
*        BUFFER. SETUP CALLER MESSAGE IN LOG BUFFER. WRITE MESSAGE.
*
*        IN         R0      MESSAGE LENGTH
*                   R1      MESSAGE ADDR
*                   R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER ADDR
*                   R13     CALLER SAVE AREA
*                   R14     RETURN ADDR
*
*        OUT        R15     RESULT CODE
*
***********************************************************************
         SPACE
@LOGW    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$W            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$W            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         SPACE
         MVI   LOGWCMSG,C' '            CLEAR MESSAGE AREA (,13)
         MVC   LOGWCMSG+1(L'LOGWCMSG-1),LOGWCMSG
         SPACE
         LTR   R0,R0                    IF MESSAGE LENGTH > 0
         BZ    @LOGW90                    AND (,12)
         LTR   R1,R1                    IF MESSAGE ADDR != 0
         BZ    @LOGW90
         SPACE
         LR    R2,R0                      MESSAGE LENGTH
         LA    R0,LOGEMAXL                MAX LOG MSG TEXT LEN
         CR    R2,R0                      IF MSG TEXT LEN TOO LONG
         BNH   @LOGW10                      (,12)
         LR    R2,R0                        SHORTEN LEN TO MAX
         SPACE
@LOGW10  DS    0H                         END IF
         SPACE
         BCTR  R2,R0                      LENGTH MINUS ONE
         EX    R2,@LOGXWRT                COPY MESSAGE TO I/O BUF (,12)
         SPACE
         LR    R10,R12                    @LOG ADDR
         LR    R11,R13                    $LOG ADDR
         BAL   R14,@LOGT                  PUT DATE/TIME INTO BUF (,12)
         SPACE
         USING @FIL,R10                   RESOLVE @FIL TO R10
         SPACE
         LA    R0,LOGWCREC                LOG RECORD ADDR (,13)
         L     R10,LOG@FIL                @FIL ADDR (,12)
         L     R11,LOG$FIL                $FIL ADDR (,13)
         BAL   R14,@FILW                  WRITE TO FILE
         SPACE
@LOGW90  DS    0H                       END IF
         SPACE
         LM    R10,R14,LOG$W            LOAD CALLER LINKAGE (,13)
         BR    R14                      RETURN TO CALLER
         SPACE
@LOGXWRT MVC   LOGWCMSG(0),0(R1)        MOVE MESSAGE TO RECORD (,13)
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @LOGC      CLOSE $LOG
*
*        IN         R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDR
*
*        OUT        R15     RESULT CODE
*
***********************************************************************
         SPACE
@LOGC    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$C            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$C            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         USING @FIL,R10
         SPACE
         L     R10,LOG@FIL              @FIL ADDR (,12)
         L     R11,LOG$FIL              $FIL ADDR (,13)
         BAL   R14,@FILC                CLOSE $FIL (,10)
         SPACE
         LM    R10,R14,LOG$C            LOAD CALLER LINKAGE (,13)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R12,R13,R10
         EJECT
***********************************************************************
*
*        @LOGZ      FINALIZE $LOG OBJECT
*
*        IN         R10     @LOG ADDR
*                   R11     $LOG ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDR
*
*        OUT        R15     FREEMAIN RESULT CODE (OR ABEND)
*
***********************************************************************
         SPACE
@LOGZ    DS    0H
         SPACE
         USING $LOG,R11
         SPACE
         STM   R10,R14,LOG$Z            SAVE CALLER LINKAGE (,11)
         LM    R12,R13,LOG$Z            LOAD LOCAL LINKAGE (,11)
         SPACE
         DROP  R11
         USING @LOG,R12
         USING $LOG,R13
         USING @FIL,R10
         SPACE
         L     R10,LOG@FIL              @FIL ADDR (,12)
         L     R11,LOG$FIL              $FIL ADDR (,13)
         BAL   R14,@FILZ                RELEASE $FIL (,10)
         SPACE
         LM    R10,R14,LOG$Z            LOAD CALLER LINKAGE (,13)
         SPACE
         DROP  R12,R13,R10
         USING @LOG,R10
         SPACE
         LR    R2,R14                   HOLD RETURN ADDR
         LR    R1,R11                   $LOG ADDR
         LA    R0,E$LOGL                $LOG LENGTH
         SPACE
         FREEMAIN R,LV=(0),A=(1)        RELEASE STORAGE (,10)
         SPACE
         LR    R14,R2                   LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R10
         EJECT
***********************************************************************
*
*        W O R K I N G   S T O R A G E
*
***********************************************************************
         SPACE
LOGEMAXL EQU   60                       MAX MESSAGE LENGTH
         SPACE
LOG@FIL  DC    A(@FIL)                  @FIL ADDR
         SPACE
LOGCF15  DC    F'15'                    ZONE MASK
LOGCPERA DC    P'1900'                  ERA
LOGCC00  DC    CL2'00'                  CENTURY MARK
         SPACE
LOGCTMON DC    H'31',H'31',H'7',CL10'January'
         DC    H'28',H'29',H'8',CL10'February'
         DC    H'31',H'31',H'5',CL10'March'
         DC    H'30',H'30',H'5',CL10'April'
         DC    H'31',H'31',H'3',CL10'May'
         DC    H'30',H'30',H'4',CL10'June'
         DC    H'31',H'31',H'4',CL10'July'
         DC    H'31',H'31',H'6',CL10'August'
         DC    H'30',H'30',H'9',CL10'September'
         DC    H'31',H'31',H'7',CL10'October'
         DC    H'30',H'30',H'8',CL10'November'
         DC    H'31',H'31',H'8',CL10'December'
         EJECT
***********************************************************************
*
*        $LOG       LOG DATA SECTION
*
***********************************************************************
         SPACE
$LOG     DSECT
         SPACE
         DS    18F                      LINKAGE SAVE AREA
         SPACE
LOG$I    DS    5F                       @LOGI SAVE AREA
LOG$O    DS    5F                       @LOGO SAVE AREA
LOG$T    DS    5F                       @LOGT SAVE AREA
LOG$W    DS    5F                       @LOGW SAVE AREA
LOG$C    DS    5F                       @LOGC SAVE AREA
LOG$Z    DS    5F                       @LOGZ SAVE AREA
         SPACE
         DS    0D
LOGWPDBL DS    PL8                      PACKED DOUBLE-WORD
         SPACE
LOG$DCB  DS    F                        DCB ADDR IN @PGM
LOG$FIL  DS    F                        $FIL ADDR
LOGWFDAT DS    F                        DATE SAVE (EEYYJJJ+)
         SPACE
LOGWHYRS DS    H                        BINARY YEAR
LOGWHWRT DS    H                        LOG FILE WRITE RESULT
         SPACE
LOGWCWRK DS    XL16                     '0HHMMSSYYYYNNDDD'
         SPACE
         DS    0D                       DOUBLE-WORD ALIGN RECORD
LOGWCREC DS    0CL80                    OUTPUT LOG RECORD
LOGWCYRS DS    CL4                        YEAR
LOGWCDL1 DS    CL1                        '.'
LOGWCMON DS    CL2                        MONTH
LOGWCDL2 DS    CL1                        '.'
LOGWCMDY DS    CL2                        DAY OF MONTH
LOGWCDL3 DS    CL1                        ' '
LOGWCHRS DS    CL2                        HOUR
LOGWCDL4 DS    CL1                        ':'
LOGWCMIN DS    CL2                        MINUTE
LOGWCDL5 DS    CL1                        ':'
LOGWCSEC DS    CL2                        SECOND
LOGWCDL6 DS    CL1                        ' '
LOGWCMSG DS    CL60                       MESSAGE
         SPACE
E$LOGL   EQU   *-$LOG                   $LOG LENGTH
         EJECT
```

### Copy Book @FIL

DWALL01.DEV.MACLIB(@FIL) implements the @FIL class for QSAM dataset I/O.
```
***********************************************************************
*
*        @FIL       FILE FACILITY
*
*        @FILA      ALLOCATE $FIL STORAGE
*        @FILI      INITIALIZE $FIL
*        @FILO      OPEN THE FILE
*        @FILR      READ FROM THE FILE
*        @FILW      WRITE TO THE FILE
*        @FILC      CLOSE THE FILE
*        @FILZ      RELEASE $FIL STORAGE
*
*        COPYRIGHT 2010-2021 DAVID J WALLING. MIT LICENSE.
*
***********************************************************************
         EJECT
***********************************************************************
*
*        @FIL       FILE CONTROL SECTION
*
***********************************************************************
         SPACE
@FIL     CSECT
         EJECT
***********************************************************************
*
*        @FILA      ALLOCATE STORAGE FOR INSTANCE
*
*        IN         R10     @FIL CSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R1      $FIL ADDR (OR ABEND)
*                   R15     GETMAIN RESULT (OR ABEND)
*
***********************************************************************
         SPACE
@FILA    DS    0H
         SPACE
         USING @FIL,R10
         SPACE
         LR    R2,R14                   HOLD RETURN ADDR
         LA    R0,E$FILL                $FIL SIZE
         SPACE
         GETMAIN R,LV=(0)               ALLOCATE STORAGE (,10)
         SPACE
         LR    R14,R2                   LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R10
         EJECT
***********************************************************************
*
*        @FILI      INITIALIZE $FIL CONTEXT
*
*        IN         R0      DCB OPTION BYTE (BITS 24-31)
*                   R1      DCB TEMPLATE ADDR
*                   R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
***********************************************************************
         SPACE
@FILI    DS    0H
         SPACE
         USING $FIL,R11
         SPACE
         ST    R14,FIL$I                SAVE RETURN ADDR (,11)
         SPACE
         STC   R0,FILXOPT               SAVE DCB OPTION BYTE (,11)
         MVC   FILXDCB,0(R1)            COPY DCB TEMPLATE (,11)
         SPACE
         L     R14,FIL$I                LOAD RETURN ADDR (,11)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R11
         EJECT
***********************************************************************
*
*        @FILO      OPEN THE FILE
*
*        IN         R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R15     OPEN RESULT CODE
*
***********************************************************************
         SPACE
@FILO    DS    0H
         SPACE
         USING $FIL,R11
         SPACE
         ST    R14,FIL$O                SAVE RETURN ADDR (,11)
         SPACE
         LA    R1,FILFARG               PARMLIST ADDR (,11)
         LA    R0,FILXDCB               DCB ADDR (,11)
         ST    R0,0(,R1)                PUT DCB ADDR IN PARMLIST
         MVC   0(1,R1),FILXOPT          SET HI BYTE TO OPTION
         SPACE
         SVC   19                       ISSUE OPEN
         SPACE
         L     R14,FIL$O                LOAD RETURN ADDR (,11)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R11
         EJECT
***********************************************************************
*
*        @FILR      READ THE FILE
*
*        IN         R0      TARGET ADDR FOR READ
*                   R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R15     GET RESULT CODE
*
*        GET ROUTINE MAY USE SAVE AREA AT R13
*
***********************************************************************
         SPACE
@FILR    DS    0H
         SPACE
         USING $FIL,R11
         SPACE
         ST    R14,FIL$R                SAVE RETURN ADDR (,11)
         SPACE
         LA    R1,FILXDCB               DCB ADDR (,11)
         L     R15,48(,R1)              DCB GET ROUTINE ADDR
         SPACE
         BALR  R14,R15                  CALL GET ROUTINE
         SPACE
         L     R14,FIL$R                LOAD RETURN ADDR (,11)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R11
         EJECT
***********************************************************************
*
*        @FILW      WRITE TO THE FILE
*
*        IN         R0      SOURCE ADDR FOR WRITE
*                   R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R15     PUT RESULT CODE
*
*        PUT ROUTINE MAY USE SAVE AREA AT 13
*
***********************************************************************
         SPACE
@FILW    DS    0H
         SPACE
         USING @FIL,R10
         USING $FIL,R11
         SPACE
         ST    R14,FIL$W                SAVE RETURN ADDR (,11)
         SPACE
         LA    R1,FILXDCB               DCB ADDR (,11)
         L     R15,48(,R1)              DCB PUT ROUTINE ADDR
         SPACE
         BALR  R14,R15                  CALL PUT ROUTINE
         SPACE
         XR    R15,R15                  ZERO RESULT IF NO SYNAD
         SPACE
@FILW80  DS    0H                       SYNAD RETURNS HERE
         SPACE
         L     R14,FIL$W                LOAD RETURN ADDR (,11)
         BR    R14                      RETURN TO CALLER
         SPACE
@FILWSYN DS    0H                       SYNAD ENTRY
         SPACE
         LR    R15,R1                   ERROR BITS 0-7
         SRL   R15,24                   ERROR BITS 24-31
         SPACE
         B     @FILW80                  CONTINUE
         SPACE
         DROP  R10,R11
         EJECT
***********************************************************************
*
*        @FILC      CLOSE THE FILE
*
*        IN         R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R15     SVC 20 RESULT CODE
*
***********************************************************************
         SPACE
@FILC    DS    0H
         SPACE
         USING $FIL,R11
         SPACE
         ST    R14,FIL$C                SAVE RETURN ADDR (,11)
         SPACE
         LA    R1,FILFARG               PARMLIST ADDR (,11)
         LA    R0,FILXDCB               DCB ADDR (,11)
         ST    R0,0(,R1)                PUT DCB ADDR IN PARMLIST
         MVI   0(R1),X'80'              MARK AS LAST PARM
         SPACE
         SVC   20                       CLOSE FILE
         SPACE
         L     R14,FIL$C                LOAD RETURN ADDR (,11)
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R11
         EJECT
***********************************************************************
*
*        @FILZ      FINALIZE $FIL OBJECT
*
*        IN         R10     @FIL CSECT ADDR
*                   R11     $FIL DSECT ADDR
*                   R12     CALLER CSECT ADDR
*                   R13     CALLER DATA ADDR (SAVE AREA)
*                   R14     RETURN ADDRESS
*
*        OUT        R15     FREEMAIN RESULT CODE (OR ABEND)
*
***********************************************************************
         SPACE
@FILZ    DS    0H
         SPACE
         USING @FIL,R10
         SPACE
         LR    R2,R14                   HOLD RETURN ADDR
         LR    R1,R11                   $FIL ADDR
         LA    R0,E$FILL                $FIL LENGTH
         SPACE
         FREEMAIN R,LV=(0),A=(1)        RELEASE STORAGE (,10)
         SPACE
         LR    R14,R2                   LOAD RETURN ADDR
         BR    R14                      RETURN TO CALLER
         SPACE
         DROP  R10
         EJECT
***********************************************************************
*
*        W O R K I N G   S T O R A G E
*
***********************************************************************
         SPACE
FILETYPI EQU   X'80'                    INPUT FILE OPTION BYTE
FILETYPO EQU   X'8F'                    OUTPUT FILE OPTION BYTE
         SPACE
***********************************************************************
*
*        $FIL       FILE DATA SECTION
*
***********************************************************************
         SPACE
$FIL     DSECT
         SPACE
FIL$I    DS    F                        @FILI RETURN ADDR
FIL$O    DS    F                        @FILO RETURN ADDR
FIL$R    DS    F                        @FILR RETURN ADDR
FIL$W    DS    F                        @FILW RETURN ADDR
FIL$C    DS    F                        @FILC RETURN ADDR
         SPACE
FILFARG  DS    F                        SVC 19,20 INPUT
         SPACE
         DS    0F                       FULLWORD ALIGN DCB
FILXDCB  DS    XL96                     DCB COPY
FILXOPT  DS    X                        OPTION BYTE
         SPACE
E$FILL   EQU   *-$FIL                   DATA SECTION LENGTH
         EJECT
```

### Job Control Language

DWALL01.DEV.JCLLIB(ASM006) invokes SYS2.PROCLIB(ASMLKED) whic hassembles, links and runs the program.

JS010 runs the ASMLKED procedure.
```
//ASM006   JOB (001),'DWALL01',CLASS=A,MSGCLASS=A, 
//             MSGLEVEL=(1,1),NOTIFY=DWALL01       
//*                                                
//*            ASSEMBLE, LINK AND RUN              
//*                                                
//JS010   EXEC ASMLKED,M=ASM006                    
//                                                 
```

### Assembly Listing

No literals were used in the program, so the literal pool (LTORG) is empty
```
1                                               EXTERNAL SYMBOL DICTIONARY                                      PAGE    1
-SYMBOL   TYPE  ID   ADDR  LENGTH LDID                                                            ASM 0201 23.23 12/17/20
0@PGM      SD  0001 000000 0001C8
 @LOG      SD  0002 0001C8 0002A2
 @FIL      SD  0003 000470 0000A4
1                                                                                                               PAGE    2
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                      1 ***********************************************************************
                                       2 *
                                       3 *        PROGRAM    ASM006
                                       4 *
                                       5 *        THIS PROGRAM WRITES A RECORD TO A DATA SET. A REUSABLE @LOG
                                       6 *        CLASS IS PLACED IN A COPY BOOK MEMBER. @LOG INHERITS FROM, OR
                                       7 *        EXTENDS, THE @FIL CLASS. @LOG ADDS DATE AND TIME INFORMATION
                                       8 *        TO THE MESSAGE WRITTEN TO THE DATA SET.
                                       9 *
                                      10 *        ENTRY      R1      PROGRAM ARGUMENTS ADDRESS
                                      11 *                   R13     CALLER SAVE AREA ADDRESS
                                      12 *                   R14     RETURN ADDRESS
                                      13 *                   R15     CONTROL SECTION ADDRESS
                                      14 *
                                      15 *        EXIT       R14     RETURN ADDRESS
                                      16 *                   R15     RESULT CODE
                                      17 *
                                      18 ***********************************************************************
1                                                                                                               PAGE    3
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                     20 ***********************************************************************
                                      21 *
                                      22 *        @PGM       PROGRAM CONTROL SECTION
                                      23 *
                                      24 ***********************************************************************

 000000                               26 @PGM     CSECT                          PROGRAM ENTRY

                             00000    28          USING @PGM,R12
                             00000    29          USING $PGM,R13

 000000 90EC D00C      0000C          31          STM   R14,R12,12(R13)          SAVE CALLER REGS
 000004 18CF                          32          LR    R12,R15                  @PGM BASE

 000006 4100 0058      00058          34          LA    R0,E$PGML                LENGTH OF STORAGE

                                      36          GETMAIN R,LV=(0)               GET STORAGE ADDR IN REG 1
 00000A 4510 C00E      0000E          37+         BAL   1,*+4                             INDICATE GETMAIN
 00000E 0A0A                          38+         SVC   10                                ISSUE GETMAIN SVC

 000010 18E1                          40          LR    R14,R1                   $PGM ADDR
 000012 41F0 0058      00058          41          LA    R15,E$PGML               $PGM SIZE
 000016 1722                          42          XR    R2,R2                    SOURCE ADDR (NO COPY)
 000018 1832                          43          LR    R3,R2                    SOURCE LENGTH (PAD)
 00001A 0EE2                          44          MVCL  R14,R2                   CLEAR STORAGE TO ZEROS

 00001C 50D0 1004      00004          46          ST    R13,4(,R1)               SAVE PARENT SAVE AREA ADDR
 000020 5010 D008      00008          47          ST    R1,8(,R13)               SAVE CURRENT SAVE AREA ADDR
 000024 18D1                          48          LR    R13,R1                   LOAD SAVE AREA ADDR

 000026 45E0 C058      00058          50          BAL   R14,@INIT                INITIALIZE PROGRAM

 00002A 12FF                          52          LTR   R15,R15                  IF INITIALIZATION SUCCEEDED
 00002C 4770 C034      00034          53          BNZ   @PGM10

 000030 45E0 C0CA      000CA          55          BAL   R14,@MAIN                  DO MAINLINE LOGIC

 000034                               57 @PGM10   DS    0H                       END IF

 000034 45E0 C100      00100          59          BAL   R14,@FINAL               FINALIZE PROGRAM

 000038 182F                          61          LR    R2,R15                   HOLD RESULT CODE

 00003A 4100 0058      00058          63          LA    R0,E$PGML                LENGTH OF STORAGE
 00003E 181D                          64          LR    R1,R13                   SAVE AREA ADDR
 000040 58D0 1004      00004          65          L     R13,4(,R1)               RESTORE PARENT SAVEAREA ADDR

                                      67          FREEMAIN R,LV=(R0),A=(R1)      RELEASE STORAGE
                                      68+*      OS/VS2 RELEASE 3 VERSION  -- 10/25/74                            00001603
 000044 1800                          69+         LR    0,R0                              LOAD LENGTH            00192003
 000046 4110 1000      00000          70+         LA    1,0(0,R1)                         LOAD AREA ADDRESS      00164002
 00004A 0A0A                          71+         SVC   10                                ISSUE FREEMAIN SVC     00311202

 00004C 18F2                          73          LR    R15,R2                   RESULT CODE

1                                                                                                               PAGE    4
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
000004E 980C D014      00014          75          LM    R0,R12,20(R13)           LOAD CALLER REGS
 000052 58E0 D00C      0000C          76          L     R14,12(,R13)             LOAD RETURN ADDR
 000056 07FE                          77          BR    R14                      RETURN TO CALLER

                                      79          DROP  R12,R13
1                                                                                                               PAGE    5
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                     81 ***********************************************************************
                                      82 *
                                      83 *        @INIT      INITIALIZE PROGRAM
                                      84 *
                                      85 ***********************************************************************

 000058                               87 @INIT    DS    0H

                             00000    89          USING @PGM,R12
                             00000    90          USING $PGM,R13
                             001C8    91          USING @LOG,R10

 000058 50E0 D048      00048          93          ST    R14,PGM$I                SAVE RETURN ADDR (,13)

 00005C 58A0 C154      00154          95          L     R10,PGM@LOG              @LOG ADDR (,12)
 000060 45E0 A000      001C8          96          BAL   R14,@LOGA                ALLOCATE $LOG (,10)

 000064 5010 D054      00054          98          ST    R1,PGM$LOG               SAVE $LOG ADDR (,13)

                                     100          WTO   '@LOGA OK'               NOTIFY CONSOLE
 000068                              101+         CNOP  0,4                                                      09800002
 000068 4510 C078      00078         102+         BAL   1,IHB0003A                        BRANCH AROUND MESSAGE  09850002
 00006C 000C                         103+         DC    AL2(12)             TEXT LENGTH                          13200002
 00006E 0000                         104+         DC    B'0000000000000000' MCS FLAGS                            13250002
 000070 7CD3D6C7C140D6D2             105+         DC    C'@LOGA OK'                                              13350002
 000078                              106+IHB0003A DS    0H                                                       15850002
 000078 0A23                         107+         SVC   35                                                       15950002

 00007A 4110 C164      00164         109          LA    R1,DCBLOG                LOG DCB ADDR (,12)
 00007E 58A0 C154      00154         110          L     R10,PGM@LOG              @LOG ADDR (,12)
 000082 58B0 D054      00054         111          L     R11,PGM$LOG              $LOG ADDR (,13)
 000086 45E0 A010      001D8         112          BAL   R14,@LOGI                INITIALIZE $LOG (,10)

                                     114          WTO   '@LOGI OK'               NOTIFY CONSOLE
 00008A 0700                         115+         CNOP  0,4                                                      09800002
 00008C 4510 C09C      0009C         116+         BAL   1,IHB0004A                        BRANCH AROUND MESSAGE  09850002
 000090 000C                         117+         DC    AL2(12)             TEXT LENGTH                          13200002
 000092 0000                         118+         DC    B'0000000000000000' MCS FLAGS                            13250002
 000094 7CD3D6C7C940D6D2             119+         DC    C'@LOGI OK'                                              13350002
 00009C                              120+IHB0004A DS    0H                                                       15850002
 00009C 0A23                         121+         SVC   35                                                       15950002

 00009E 58A0 C154      00154         123          L     R10,PGM@LOG              @LOG ADDR (,12)
 0000A2 58B0 D054      00054         124          L     R11,PGM$LOG              $LOG ADDR (,13)
 0000A6 45E0 A05A      00222         125          BAL   R14,@LOGO                OPEN LOG FILE (,10)

 0000AA 12FF                         127          LTR   R15,R15                  IF FILE OPEN
 0000AC 4770 C0C4      000C4         128          BNZ   @INIT10

                                     130          WTO   '@LOGO OK'                 NOTIFY CONSOLE
 0000B0                              131+         CNOP  0,4                                                      09800002
 0000B0 4510 C0C0      000C0         132+         BAL   1,IHB0005A                        BRANCH AROUND MESSAGE  09850002
 0000B4 000C                         133+         DC    AL2(12)             TEXT LENGTH                          13200002
 0000B6 0000                         134+         DC    B'0000000000000000' MCS FLAGS                            13250002
 0000B8 7CD3D6C7D640D6D2             135+         DC    C'@LOGO OK'                                              13350002
1                                                                                                               PAGE    6
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
00000C0                              136+IHB0005A DS    0H                                                       15850002
 0000C0 0A23                         137+         SVC   35                                                       15950002

 0000C2 17FF                         139          XR    R15,R15                    ZERO RESULT CODE

 0000C4                              141 @INIT10  DS    0H                       END IF

 0000C4 58E0 D048      00048         143          L     R14,PGM$I                LOAD RETURN ADDR (,13)
 0000C8 07FE                         144          BR    R14                      RETURN TO CALLER

                                     146          DROP  R12,R13,R10
1                                                                                                               PAGE    7
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    148 ***********************************************************************
                                     149 *
                                     150 *        @MAIN      MAIN LOGIC LOOP
                                     151 *
                                     152 ***********************************************************************

 0000CA                              154 @MAIN    DS    0H

                             00000   156          USING @PGM,R12
                             00000   157          USING $PGM,R13
                             001C8   158          USING @LOG,R10

 0000CA 50E0 D04C      0004C         160          ST    R14,PGM$M                SAVE RETURN ADDR

 0000CE 4100 000B      0000B         162          LA    R0,L'CCLOGMSG            MESSAGE SIZE
 0000D2 4110 C158      00158         163          LA    R1,CCLOGMSG              MESSAGE ADDR (,12)
 0000D6 58A0 C154      00154         164          L     R10,PGM@LOG              @LOG ADDR (,12)
 0000DA 58B0 D054      00054         165          L     R11,PGM$LOG              $LOG ADDR (,13)
 0000DE 45E0 A13A      00302         166          BAL   R14,@LOGW                WRITE MESSAGE

 0000E2 12FF                         168          LTR   R15,R15                  IF RECORD WRITTEN
 0000E4 4770 C0FA      000FA         169          BNZ   @MAIN10

                                     171          WTO   '@LOGW OK'                 NOTIFY CONSOLE
 0000E8                              172+         CNOP  0,4                                                      09800002
 0000E8 4510 C0F8      000F8         173+         BAL   1,IHB0006A                        BRANCH AROUND MESSAGE  09850002
 0000EC 000C                         174+         DC    AL2(12)             TEXT LENGTH                          13200002
 0000EE 0000                         175+         DC    B'0000000000000000' MCS FLAGS                            13250002
 0000F0 7CD3D6C7E640D6D2             176+         DC    C'@LOGW OK'                                              13350002
 0000F8                              177+IHB0006A DS    0H                                                       15850002
 0000F8 0A23                         178+         SVC   35                                                       15950002

 0000FA                              180 @MAIN10  DS    0H                       END IF

 0000FA 58E0 D04C      0004C         182          L     R14,PGM$M                LOAD RETURN ADDR
 0000FE 07FE                         183          BR    R14                      RETURN TO CALLER

                                     185          DROP  R12,R13,R10
1                                                                                                               PAGE    8
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    187 ***********************************************************************
                                     188 *
                                     189 *        @FINAL     FINALIZATION ROUTINE
                                     190 *
                                     191 ***********************************************************************

 000100                              193 @FINAL   DS    0H

                             00000   195          USING @PGM,R12
                             00000   196          USING $PGM,R13
                             001C8   197          USING @LOG,R10

 000100 50E0 D050      00050         199          ST    R14,PGM$F                SAVE RETURN ADDR

 000104 58A0 C154      00154         201          L     R10,PGM@LOG              @LOG ADDR (,12)
 000108 58B0 D054      00054         202          L     R11,PGM$LOG              $LOG ADDR (,13)
 00010C 45E0 A190      00358         203          BAL   R14,@LOGC                CLOSE LOG FILE (,10)

 000110 12FF                         205          LTR   R15,R15                  IF FILE CLOSED
 000112 4770 C12A      0012A         206          BNZ   @FINL10

                                     208          WTO   '@LOGC OK'                 NOTIFY CONSOLE
 000116 0700                         209+         CNOP  0,4                                                      09800002
 000118 4510 C128      00128         210+         BAL   1,IHB0007A                        BRANCH AROUND MESSAGE  09850002
 00011C 000C                         211+         DC    AL2(12)             TEXT LENGTH                          13200002
 00011E 0000                         212+         DC    B'0000000000000000' MCS FLAGS                            13250002
 000120 7CD3D6C7C340D6D2             213+         DC    C'@LOGC OK'                                              13350002
 000128                              214+IHB0007A DS    0H                                                       15850002
 000128 0A23                         215+         SVC   35                                                       15950002

 00012A                              217 @FINL10  DS    0H                       END IF

 00012A 58A0 C154      00154         219          L     R10,PGM@LOG              @LOG ADDR (,12)
 00012E 58B0 D054      00054         220          L     R11,PGM$LOG              $LOG ADDR (,13)
 000132 45E0 A1AA      00372         221          BAL   R14,@LOGZ                RELEASE LOG (,10)

                                     223          WTO   '@LOGZ OK'               NOTIFY CONSOLE
 000136 0700                         224+         CNOP  0,4                                                      09800002
 000138 4510 C148      00148         225+         BAL   1,IHB0008A                        BRANCH AROUND MESSAGE  09850002
 00013C 000C                         226+         DC    AL2(12)             TEXT LENGTH                          13200002
 00013E 0000                         227+         DC    B'0000000000000000' MCS FLAGS                            13250002
 000140 7CD3D6C7E940D6D2             228+         DC    C'@LOGZ OK'                                              13350002
 000148                              229+IHB0008A DS    0H                                                       15850002
 000148 0A23                         230+         SVC   35                                                       15950002

 00014A 17FF                         232          XR    R15,R15                  ZERO RESULT CODE

 00014C 58E0 D050      00050         234          L     R14,PGM$F                LOAD RETURN ADDR
 000150 07FE                         235          BR    R14                      RETURN TO CALLER

                                     237          DROP  R12,R13,R10
1                                                                                                               PAGE    9
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    239 ***********************************************************************
                                     240 *
                                     241 *        W O R K I N G   S T O R A G E
                                     242 *
                                     243 ***********************************************************************

                                     245          COPY  EREGS
                                     246 ***********************************************************************
                                     247 *
                                     248 *        EQUATES
                                     249 *
                                     250 ***********************************************************************

                                     252 *                                       *******************************
                                     253 *                                       *  REGISTERS
                                     254 *                                       *******************************

                             00000   256 R0       EQU   0
                             00001   257 R1       EQU   1
                             00002   258 R2       EQU   2
                             00003   259 R3       EQU   3
                             00004   260 R4       EQU   4
                             00005   261 R5       EQU   5
                             00006   262 R6       EQU   6
                             00007   263 R7       EQU   7
                             00008   264 R8       EQU   8
                             00009   265 R9       EQU   9
                             0000A   266 R10      EQU   10
                             0000B   267 R11      EQU   11
                             0000C   268 R12      EQU   12
                             0000D   269 R13      EQU   13
                             0000E   270 R14      EQU   14
                             0000F   271 R15      EQU   15

 000152 0000
 000154 000001C8                     273 PGM@LOG  DC    A(@LOG)                  @LOG ADDR

 000158 D3D6C740D4C5E2E2             275 CCLOGMSG DC    C'LOG MESSAGE'

                                     277 DCBLOG   DCB   DDNAME=LOG,DSORG=PS,RECFM=FB,                           X
                                                        LRECL=80,MACRF=(PM),SYNAD=@FILWSYN
0
                                     279+*                       DATA CONTROL BLOCK                              22770020
                                     280+*                                                                       22860020
 000163 00
 000164                              281+DCBLOG   DC    0F'0'                   ORIGIN ON WORD BOUNDARY          22914020

                                     283+*                       DIRECT ACCESS DEVICE INTERFACE                  27360020

 000164 0000000000000000             285+         DC    BL16'0'                  FDAD,DVTBL                      27540020
 000174 00000000                     286+         DC    A(0)                     KEYLE,DEVT,TRBAL                27720020

                                     288+*                       COMMON ACCESS METHOD INTERFACE                  48690020

1                                                                                                               PAGE   10
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0000178 00                           290+         DC    AL1(0)                  BUFNO                            49050020
 000179 000001                       291+         DC    AL3(1)                  BUFCB                            54720020
 00017C 0000                         292+         DC    AL2(0)             BUFL                                  55170020
 00017E 4000                         293+         DC    BL2'0100000000000000'                                   *55800020
                                        +                                                 DSORG                  55890020
 000180 00000001                     294+         DC    A(1)                     IOBAD                           56340020

                                     296+*                       FOUNDATION EXTENSION                            56610020

 000184 00                           298+         DC    BL1'00000000'                  BFTEK,BFLN,HIARCHY        59850020
 000185 000001                       299+         DC    AL3(1)                  EODAD                            65970020
 000188 90                           300+         DC    BL1'10010000'                                           *66150020
                                        +                                       RECFM                            66240020
 000189 000000                       301+         DC    AL3(0)                  EXLST                            66330020

                                     303+*                       FOUNDATION BLOCK                                66690020

 00018C D3D6C74040404040             305+         DC    CL8'LOG'                DDNAME                           66870020
 000194 02                           306+         DC    BL1'00000010'           OFLGS                            68220020
 000195 00                           307+         DC    BL1'00000000'                          IFLG              68310020
 000196 0050                         308+         DC    BL2'0000000001010000'                                   *68400020
                                        +                                                                       *68490020
                                        +                                       MACR                             68580020

                                     310+*                       BSAM-BPAM-QSAM INTERFACE                        74430020

 000198 00                           312+         DC    BL1'00000000'                                           *74610020
                                        +                                                                   RER1 74700020
 000199 000001                       313+         DC    AL3(1)                  CHECK, GERR, PERR                74790020
 00019C 000004DC                     314+         DC    A(@FILWSYN)             SYNAD                            74880020
 0001A0 0000                         315+         DC    H'0'                    CIND1, CIND2                     74970020
 0001A2 0000                         316+         DC    AL2(0)                  BLKSIZE                          75240020
 0001A4 00000000                     317+         DC    F'0'                    WCPO, WCPL, OFFSR, OFFSW         75870020
 0001A8 00000001                     318+         DC    A(1)                    IOBA                             75960020
 0001AC 00                           319+         DC    AL1(0)                  NCP                              76050020
 0001AD 000001                       320+         DC    AL3(1)                  EOBR, EOBAD                      76140020

                                     322+*                            QSAM INTERFACE                             81450020

 0001B0 00000001                     324+         DC    A(1)                     RECAD                           81630020
 0001B4 0000                         325+         DC    H'0'                    QSWS                             81810020
 0001B6 0050                         326+         DC    AL2(80)        LRECL                                     80730020
 0001B8 00                           327+         DC    BL1'00000000'           EROPT                            82530020
 0001B9 000001                       328+         DC    AL3(1)                  CNTRL                            82620020
 0001BC 00000000                     329+         DC    F'0'                    PRECL                            82710020
 0001C0 00000001                     330+         DC    A(1)                    EOB                              82800020
1                                                                                                               PAGE   11
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
00001C8                              332          LTORG
1                                                                                                               PAGE   12
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    334 ***********************************************************************
                                     335 *
                                     336 *        $PGM       PROGRAM DATA SECTION
                                     337 *
                                     338 ***********************************************************************

 000000                              340 $PGM     DSECT

 000000                              342          DS    18F                      REGISTER SAVE AREA

 000048                              344 PGM$I    DS    F                        @INIT RETURN ADDR
 00004C                              345 PGM$M    DS    F                        @MAIN RETURN ADDR
 000050                              346 PGM$F    DS    F                        @FINAL RETURN ADDR

 000054                              348 PGM$LOG  DS    F                        $LOG ADDR

                             00058   350 E$PGML   EQU   *-$PGM                   SIZE OF SAVE AREA

1                                                                                                               PAGE   13
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    353 ***********************************************************************
                                     354 *
                                     355 *        INCLUDED OBJECTS
                                     356 *
                                     357 ***********************************************************************

                                     359          COPY  @LOG                     LOG CLASS
                                     360 ***********************************************************************
                                     361 *
                                     362 *        @LOG       LOG FACILITY
                                     363 *
                                     364 *        @LOGA      ALLOCATE STORAGE FOR $LOG INSTANCE
                                     365 *        @LOGI      INITIALIZE INSTANCE
                                     366 *        @LOGO      OPEN THE FILE
                                     367 *        @LOGR      READ FROM THE FILE
                                     368 *        @LOGW      WRITE TO THE FILE
                                     369 *        @LOGC      CLOSE THE FILE
                                     370 *        @LOGZ      FINALIZE THE $LOG INSTANCE
                                     371 *
                                     372 *        COPYRIGHT 2010-2021 DAVID J WALLING. MIT LICENSE.
                                     373 *
                                     374 ***********************************************************************
1                                                                                                               PAGE   14
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    376 ***********************************************************************
                                     377 *
                                     378 *        @LOG       LOG CONTROL SECTION
                                     379 *
                                     380 ***********************************************************************

 0001C8                              382 @LOG     CSECT
1                                                                                                               PAGE   15
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    384 ***********************************************************************
                                     385 *
                                     386 *        @LOGA      ALLOCATE STORAGE FOR INSTANCE
                                     387 *
                                     388 *        IN         R10     @LOG CSECT ADDR
                                     389 *                   R12     CALLER CSECT ADDR
                                     390 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     391 *                   R14     RETURN ADDR
                                     392 *
                                     393 *        OUT        R1      $LOG ADDR (OR ABEND)
                                     394 *                   R15     GETMAIN RESULT (OR ABEND)
                                     395 *
                                     396 ***********************************************************************

 0001C8                              398 @LOGA    DS    0H

                             001C8   400          USING @LOG,R10

 0001C8 182E                         402          LR    R2,R14                   HOLD RETURN ADDR
 0001CA 4100 0138      00138         403          LA    R0,E$LOGL                $LOG SIZE

                                     405          GETMAIN R,LV=(0)               ALLOCATE STORAGE (,10)
 0001CE 4510 A00A      001D2         406+         BAL   1,*+4                             INDICATE GETMAIN
 0001D2 0A0A                         407+         SVC   10                                ISSUE GETMAIN SVC

 0001D4 18E2                         409          LR    R14,R2                   LOAD RETURN ADDR
 0001D6 07FE                         410          BR    R14                      RETURN TO CALLER

                                     412          DROP  R10
1                                                                                                               PAGE   16
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    414 ***********************************************************************
                                     415 *
                                     416 *        @LOGI      INITIALIZE $LOG CONTEXT
                                     417 *
                                     418 *        IN         R1      DCB TEMPLATE ADDR
                                     419 *                   R10     @LOG ADDR
                                     420 *                   R11     $LOG ADDR
                                     421 *                   R12     CALLER CODE
                                     422 *                   R13     CALLER DATA
                                     423 *                   R14     RETURN ADDR
                                     424 *
                                     425 ***********************************************************************

 0001D8                              427 @LOGI    DS    0H

                             00000   429          USING $LOG,R11

 0001D8 90AE B048      00048         431          STM   R10,R14,LOG$I            SAVE CALLER LINKAGE (,11)
 0001DC 98CD B048      00048         432          LM    R12,R13,LOG$I            LOAD LOCAL LINKAGE (,11)

                                     434          DROP  R11
                             001C8   435          USING @LOG,R12
                             00000   436          USING $LOG,R13
                             00470   437          USING @FIL,R10

 0001E0 5010 D0C8      000C8         439          ST    R1,LOG$DCB               SAVE DCB TEMPLATE ADDR (,13)

 0001E4 924B D0EC      000EC         441          MVI   LOGWCDL1,C'.'            DELIMITER 1
 0001E8 924B D0EF      000EF         442          MVI   LOGWCDL2,C'.'            DELIMITER 2
 0001EC 9240 D0F2      000F2         443          MVI   LOGWCDL3,C' '            DELIMITER 3
 0001F0 927A D0F5      000F5         444          MVI   LOGWCDL4,C':'            DELIMITER 4
 0001F4 927A D0F8      000F8         445          MVI   LOGWCDL5,C':'            DELIMITER 5
 0001F8 9240 D0FB      000FB         446          MVI   LOGWCDL6,C' '            DELIMITER 6

 0001FC 58A0 C1D4      0039C         448          L     R10,LOG@FIL              @FIL BASE (,12)
 000200 45E0 A000      00470         449          BAL   R14,@FILA                ALLOCATE $FIL (,10)

 000204 5010 D0CC      000CC         451          ST    R1,LOG$FIL               SAVE $FIL ADDR (,13)

 000208 4100 008F      0008F         453          LA    R0,FILETYPO              DCB OPTION BYTE FOR LOG
 00020C 5810 D0C8      000C8         454          L     R1,LOG$DCB               DCB TEMPLATE FOR LOG (,13)
 000210 58A0 C1D4      0039C         455          L     R10,LOG@FIL              @FIL BASE (,12)
 000214 58B0 D0CC      000CC         456          L     R11,LOG$FIL              $FIL BASE (,13)
 000218 45E0 A010      00480         457          BAL   R14,@FILI                INITIALIZE $FIL (,10)

 00021C 98AE D048      00048         459          LM    R10,R14,LOG$I            LOAD CALLER LINKAGE (,13)
 000220 07FE                         460          BR    R14                      RETURN TO CALLER

                                     462          DROP  R12,R13,R10
1                                                                                                               PAGE   17
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    464 ***********************************************************************
                                     465 *
                                     466 *        @LOGO      OPEN LOG
                                     467 *
                                     468 *        IN         R10     @LOG ADDR
                                     469 *                   R11     $LOG ADDR
                                     470 *                   R12     CALLER CODE
                                     471 *                   R13     CALLER SAVE AREA
                                     472 *                   R14     RETURN ADDR
                                     473 *
                                     474 *        OUT        R15     RESULT CODE
                                     475 *
                                     476 ***********************************************************************

 000222                              478 @LOGO    DS    0H

                             00000   480          USING $LOG,R11

 000222 90AE B05C      0005C         482          STM   R10,R14,LOG$O            SAVE CALLER LINKAGE (,11)
 000226 98CD B05C      0005C         483          LM    R12,R13,LOG$O            LOAD LOCAL LINKAGE (,11)

                                     485          DROP  R11
                             001C8   486          USING @LOG,R12
                             00000   487          USING $LOG,R13
                             00470   488          USING @FIL,R10

 00022A 58A0 C1D4      0039C         490          L     R10,LOG@FIL              @FIL ADDR (,12)
 00022E 58B0 D0CC      000CC         491          L     R11,LOG$FIL              $FIL ADDR (,13)
 000232 45E0 A024      00494         492          BAL   R14,@FILO                OPEN $FIL (,10)


 000236 98AE D05C      0005C         495          LM    R10,R14,LOG$O            LOAD CALLER LINKAGE (,13)
 00023A 07FE                         496          BR    R14                      RETURN TO CALLER

                                     498          DROP  R12,R13,R10
1                                                                                                               PAGE   18
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    500 ***********************************************************************
                                     501 *
                                     502 *        @LOGT      GET CURRENT DATE TIME AND CONVERT
                                     503 *
                                     504 *        UPDATE THE DATE AND TIME IN THE LOG OUPUT RECORD IF THE
                                     505 *        CURRENT DATE AND TIME HAVE CHANGED.
                                     506 *
                                     507 *        IN         R10     @LOG ADDR
                                     508 *                   R11     $LOG ADDR
                                     509 *                   R12     CALLER ADDR
                                     510 *                   R13     CALLER SAVE AREA
                                     511 *                   R14     RETURN ADDR
                                     512 *
                                     513 *        OUT        R15     RESULT CODE
                                     514 *
                                     515 ***********************************************************************

 00023C                              517 @LOGT    DS    0H

                             00000   519          USING $LOG,R11

 00023C 90AE B070      00070         521          STM   R10,R14,LOG$T            SAVE CALLER LINKAGE (,11)
 000240 98CD B070      00070         522          LM    R12,R13,LOG$T            LOAD LOCAL LINKAGE (,11)

                                     524          DROP  R11
                             001C8   525          USING @LOG,R12
                             00000   526          USING $LOG,R13

                                     528          TIME  ZONE=LT                  R0,R1 = 0HHMMSST YYYYJJJZ
                                     529+* /* MACDATE Y-1 72277                                               */ 02050002
                                     530+* /*                                                                    02100002
 000244 4110 0002      00002         531+         LA    1,2(0,0)                          LOAD 1 TO SPECIFY UNIT 22000002
 000248 0A0B                         532+         SVC   11                                ISSUE TIME SVC         35000002

 00024A 9001 D0C0      000C0         534          STM   R0,R1,LOGWPDBL           STORE PACKED TIME AND DATE
 00024E F3F7 D0D8 D0C0 000D8 000C0   535          UNPK  LOGWCWRK,LOGWPDBL        ZONE DECIMAL TIME AND DATE

 000254 D201 D0F3 D0D9 000F3 000D9   537          MVC   LOGWCHRS,LOGWCWRK+1      STORE HOUR
 00025A D201 D0F6 D0DB 000F6 000DB   538          MVC   LOGWCMIN,LOGWCWRK+3      STORE MINUTE
 000260 D201 D0F9 D0DD 000F9 000DD   539          MVC   LOGWCSEC,LOGWCWRK+5      STORE SECOND

 000266 5910 D0D0      000D0         541          C     R1,LOGWFDAT              IF DATE HAS CHANGED
 00026A 4780 C134      002FC         542          BE    @LOGT40

 00026E 5010 D0D0      000D0         544          ST    R1,LOGWFDAT                UPDATE SAVED DATE

 000272 1700                         546          XR    R0,R0                      00000000 YYYYJJJ+
 000274 8810 000C      0000C         547          SRL   R1,12                      00000000 000YYYYJ
 000278 5610 C1D8      003A0         548          O     R1,LOGCF15                 00000000 000YYYYF

 00027C 9001 D0C0      000C0         550          STM   R0,R1,LOGWPDBL             STORE ERA AND YEAR
 000280 FA72 D0C0 C1DC 000C0 003A4   551          AP    LOGWPDBL,LOGCPERA          PACKED YEAR
 000286 F337 D0E8 D0C0 000E8 000C0   552          UNPK  LOGWCYRS,LOGWPDBL          ZONED DECIMAL YEAR
 00028C 96F0 D0EB      000EB         553          OI    LOGWCYRS+(L'LOGWCYRS-1),X'F0'

1                                                                                                               PAGE   19
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0000290 4F10 D0C0      000C0         555          CVB   R1,LOGWPDBL                00000000 0000YYYY
 000294 4010 D0D4      000D4         556          STH   R1,LOGWHYRS                STORE BINARY YEAR
 000298 BF13 D0D2      000D2         557          ICM   R1,B'0011',LOGWFDAT+2      00000000 0000JJJ+
 00029C 9001 D0C0      000C0         558          STM   R0,R1,LOGWPDBL             STORE DECIMAL JULIAN DAY
 0002A0 4F10 D0C0      000C0         559          CVB   R1,LOGWPDBL                00000000 00000JJJ
1                                                                                                               PAGE   20
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
00002A4 4130 C1E2      003AA         561          LA    R3,LOGCTMON                TABLE OF MONTHS
 0002A8 9103 D0D5      000D5         562          TM    LOGWHYRS+1,X'03'           IF YEAR MOD 4 IS ZERO
 0002AC 4770 C0F6      002BE         563          BNZ   @LOGT10                      AND
 0002B0 D503 D0EA C1DF 000EA 003A7   564          CLC   LOGWCYRS+2,LOGCC00         IF NOT CENTURY MARK
 0002B6 4780 C0F6      002BE         565          BE    @LOGT10
 0002BA 4130 3002      00002         566          LA    R3,2(,R3)                    LEAP-DAY TABLE OFFSET

 0002BE                              568 @LOGT10  DS    0H                         END IF

 0002BE 4100 000C      0000C         570          LA    R0,12                      MONTHS PER YEAR
 0002C2 1722                         571          XR    R2,R2                      ZERO TABLE INDEX

 0002C4                              573 @LOGT20  DS    0H                         WHILE DAY > MAX DAY(MONTH)

 0002C4 4912 3000      00000         575          CH    R1,0(R2,R3)
 0002C8 47D0 C110      002D8         576          BNH   @LOGT30
 0002CC 4B12 3000      00000         577          SH    R1,0(R2,R3)                  SUBTRACT MAX DAY(MONTH)
 0002D0 4120 2010      00010         578          LA    R2,16(,R2)                   POINT TO NEXT ELEMENT
 0002D4 4600 C0FC      002C4         579          BCT   R0,@LOGT20

 0002D8                              581 @LOGT30  DS    0H                         END DO

 0002D8 8820 0004      00004         583          SRL   R2,4                       CONVERT OFFSET TO INDEX
 0002DC 4120 2001      00001         584          LA    R2,1(,R2)                  MONTH (1-12)

 0002E0 4E20 D0C0      000C0         586          CVD   R2,LOGWPDBL                PACKED MONTH
 0002E4 F317 D0ED D0C0 000ED 000C0   587          UNPK  LOGWCMON,LOGWPDBL          ZONED DECIMAL
 0002EA 96F0 D0EE      000EE         588          OI    LOGWCMON+(L'LOGWCMON-1),X'F0'

 0002EE 4E10 D0C0      000C0         590          CVD   R1,LOGWPDBL                PACKED DAY (1-31)
 0002F2 F317 D0F0 D0C0 000F0 000C0   591          UNPK  LOGWCMDY,LOGWPDBL          ZONED DECIMAL
 0002F8 96F0 D0F1      000F1         592          OI    LOGWCMDY+(L'LOGWCMDY-1),X'F0'

 0002FC                              594 @LOGT40  DS    0H                       END IF

 0002FC 98AE D070      00070         596          LM    R10,R14,LOG$T            LOAD CALLER LINKAGE
 000300 07FE                         597          BR    R14                      RETURN TO CALLER

                                     599          DROP  R12,R13
1                                                                                                               PAGE   21
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    601 ***********************************************************************
                                     602 *
                                     603 *        @LOGW      WRITE MESSAGE TO LOG FILE
                                     604 *
                                     605 *        TRUNCATE MESSAGE IF TOO LONG. SETUP DATE AND TIME IN LOG
                                     606 *        BUFFER. SETUP CALLER MESSAGE IN LOG BUFFER. WRITE MESSAGE.
                                     607 *
                                     608 *        IN         R0      MESSAGE LENGTH
                                     609 *                   R1      MESSAGE ADDR
                                     610 *                   R10     @LOG ADDR
                                     611 *                   R11     $LOG ADDR
                                     612 *                   R12     CALLER ADDR
                                     613 *                   R13     CALLER SAVE AREA
                                     614 *                   R14     RETURN ADDR
                                     615 *
                                     616 *        OUT        R15     RESULT CODE
                                     617 *
                                     618 ***********************************************************************

 000302                              620 @LOGW    DS    0H

                             00000   622          USING $LOG,R11

 000302 90AE B084      00084         624          STM   R10,R14,LOG$W            SAVE CALLER LINKAGE (,11)
 000306 98CD B084      00084         625          LM    R12,R13,LOG$W            LOAD LOCAL LINKAGE (,11)

                                     627          DROP  R11
                             001C8   628          USING @LOG,R12
                             00000   629          USING $LOG,R13

 00030A 9240 D0FC      000FC         631          MVI   LOGWCMSG,C' '            CLEAR MESSAGE AREA (,13)
 00030E D23A D0FD D0FC 000FD 000FC   632          MVC   LOGWCMSG+1(L'LOGWCMSG-1),LOGWCMSG

 000314 1200                         634          LTR   R0,R0                    IF MESSAGE LENGTH > 0
 000316 4780 C184      0034C         635          BZ    @LOGW90                    AND (,12)
 00031A 1211                         636          LTR   R1,R1                    IF MESSAGE ADDR != 0
 00031C 4780 C184      0034C         637          BZ    @LOGW90

 000320 1820                         639          LR    R2,R0                      MESSAGE LENGTH
 000322 4100 003C      0003C         640          LA    R0,LOGEMAXL                MAX LOG MSG TEXT LEN
 000326 1920                         641          CR    R2,R0                      IF MSG TEXT LEN TOO LONG
 000328 47D0 C166      0032E         642          BNH   @LOGW10                      (,12)
 00032C 1820                         643          LR    R2,R0                        SHORTEN LEN TO MAX

 00032E                              645 @LOGW10  DS    0H                         END IF

 00032E 0620                         647          BCTR  R2,R0                      LENGTH MINUS ONE
 000330 4420 C18A      00352         648          EX    R2,@LOGXWRT                COPY MESSAGE TO I/O BUF (,12)

 000334 18AC                         650          LR    R10,R12                    @LOG ADDR
 000336 18BD                         651          LR    R11,R13                    $LOG ADDR
 000338 45E0 C074      0023C         652          BAL   R14,@LOGT                  PUT DATE/TIME INTO BUF (,12)

                             00470   654          USING @FIL,R10                   RESOLVE @FIL TO R10

1                                                                                                               PAGE   22
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
000033C 4100 D0E8      000E8         656          LA    R0,LOGWCREC                LOG RECORD ADDR (,13)
 000340 58A0 C1D4      0039C         657          L     R10,LOG@FIL                @FIL ADDR (,12)
 000344 58B0 D0CC      000CC         658          L     R11,LOG$FIL                $FIL ADDR (,13)
 000348 45E0 A056      004C6         659          BAL   R14,@FILW                  WRITE TO FILE

 00034C                              661 @LOGW90  DS    0H                       END IF

 00034C 98AE D084      00084         663          LM    R10,R14,LOG$W            LOAD CALLER LINKAGE (,13)
 000350 07FE                         664          BR    R14                      RETURN TO CALLER

 000352 D200 D0FC 1000 000FC 00000   666 @LOGXWRT MVC   LOGWCMSG(0),0(R1)        MOVE MESSAGE TO RECORD (,13)

                                     668          DROP  R12,R13,R10
1                                                                                                               PAGE   23
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    670 ***********************************************************************
                                     671 *
                                     672 *        @LOGC      CLOSE $LOG
                                     673 *
                                     674 *        IN         R10     @LOG ADDR
                                     675 *                   R11     $LOG ADDR
                                     676 *                   R12     CALLER CSECT ADDR
                                     677 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     678 *                   R14     RETURN ADDR
                                     679 *
                                     680 *        OUT        R15     RESULT CODE
                                     681 *
                                     682 ***********************************************************************

 000358                              684 @LOGC    DS    0H

                             00000   686          USING $LOG,R11

 000358 90AE B098      00098         688          STM   R10,R14,LOG$C            SAVE CALLER LINKAGE (,11)
 00035C 98CD B098      00098         689          LM    R12,R13,LOG$C            LOAD LOCAL LINKAGE (,11)

                                     691          DROP  R11
                             001C8   692          USING @LOG,R12
                             00000   693          USING $LOG,R13
                             00470   694          USING @FIL,R10

 000360 58A0 C1D4      0039C         696          L     R10,LOG@FIL              @FIL ADDR (,12)
 000364 58B0 D0CC      000CC         697          L     R11,LOG$FIL              $FIL ADDR (,13)
 000368 45E0 A076      004E6         698          BAL   R14,@FILC                CLOSE $FIL (,10)

 00036C 98AE D098      00098         700          LM    R10,R14,LOG$C            LOAD CALLER LINKAGE (,13)
 000370 07FE                         701          BR    R14                      RETURN TO CALLER

                                     703          DROP  R12,R13,R10
1                                                                                                               PAGE   24
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    705 ***********************************************************************
                                     706 *
                                     707 *        @LOGZ      FINALIZE $LOG OBJECT
                                     708 *
                                     709 *        IN         R10     @LOG ADDR
                                     710 *                   R11     $LOG ADDR
                                     711 *                   R12     CALLER CSECT ADDR
                                     712 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     713 *                   R14     RETURN ADDR
                                     714 *
                                     715 *        OUT        R15     FREEMAIN RESULT CODE (OR ABEND)
                                     716 *
                                     717 ***********************************************************************

 000372                              719 @LOGZ    DS    0H

                             00000   721          USING $LOG,R11

 000372 90AE B0AC      000AC         723          STM   R10,R14,LOG$Z            SAVE CALLER LINKAGE (,11)
 000376 98CD B0AC      000AC         724          LM    R12,R13,LOG$Z            LOAD LOCAL LINKAGE (,11)

                                     726          DROP  R11
                             001C8   727          USING @LOG,R12
                             00000   728          USING $LOG,R13
                             00470   729          USING @FIL,R10

 00037A 58A0 C1D4      0039C         731          L     R10,LOG@FIL              @FIL ADDR (,12)
 00037E 58B0 D0CC      000CC         732          L     R11,LOG$FIL              $FIL ADDR (,13)
 000382 45E0 A092      00502         733          BAL   R14,@FILZ                RELEASE $FIL (,10)

 000386 98AE D0AC      000AC         735          LM    R10,R14,LOG$Z            LOAD CALLER LINKAGE (,13)

                                     737          DROP  R12,R13,R10
                             001C8   738          USING @LOG,R10

 00038A 182E                         740          LR    R2,R14                   HOLD RETURN ADDR
 00038C 181B                         741          LR    R1,R11                   $LOG ADDR
 00038E 4100 0138      00138         742          LA    R0,E$LOGL                $LOG LENGTH

                                     744          FREEMAIN R,LV=(0),A=(1)        RELEASE STORAGE (,10)
                                     745+*      OS/VS2 RELEASE 3 VERSION  -- 10/25/74                            00001603
 000392 4110 1000      00000         746+         LA    1,0(0,1)                          CLEAR HI ORDER BYTE    00150802
 000396 0A0A                         747+         SVC   10                                ISSUE FREEMAIN SVC     00311202

 000398 18E2                         749          LR    R14,R2                   LOAD RETURN ADDR
 00039A 07FE                         750          BR    R14                      RETURN TO CALLER

                                     752          DROP  R10
1                                                                                                               PAGE   25
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    754 ***********************************************************************
                                     755 *
                                     756 *        W O R K I N G   S T O R A G E
                                     757 *
                                     758 ***********************************************************************

                             0003C   760 LOGEMAXL EQU   60                       MAX MESSAGE LENGTH

 00039C 00000470                     762 LOG@FIL  DC    A(@FIL)                  @FIL ADDR

 0003A0 0000000F                     764 LOGCF15  DC    F'15'                    ZONE MASK
 0003A4 01900C                       765 LOGCPERA DC    P'1900'                  ERA
 0003A7 F0F0                         766 LOGCC00  DC    CL2'00'                  CENTURY MARK

 0003A9 00
 0003AA 001F001F0007D181             768 LOGCTMON DC    H'31',H'31',H'7',CL10'January'
 0003BA 001C001D0008C685             769          DC    H'28',H'29',H'8',CL10'February'
 0003CA 001F001F0005D481             770          DC    H'31',H'31',H'5',CL10'March'
 0003DA 001E001E0005C197             771          DC    H'30',H'30',H'5',CL10'April'
 0003EA 001F001F0003D481             772          DC    H'31',H'31',H'3',CL10'May'
 0003FA 001E001E0004D1A4             773          DC    H'30',H'30',H'4',CL10'June'
 00040A 001F001F0004D1A4             774          DC    H'31',H'31',H'4',CL10'July'
 00041A 001F001F0006C1A4             775          DC    H'31',H'31',H'6',CL10'August'
 00042A 001E001E0009E285             776          DC    H'30',H'30',H'9',CL10'September'
 00043A 001F001F0007D683             777          DC    H'31',H'31',H'7',CL10'October'
 00044A 001E001E0008D596             778          DC    H'30',H'30',H'8',CL10'November'
 00045A 001F001F0008C485             779          DC    H'31',H'31',H'8',CL10'December'
1                                                                                                               PAGE   26
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    781 ***********************************************************************
                                     782 *
                                     783 *        $LOG       LOG DATA SECTION
                                     784 *
                                     785 ***********************************************************************

 000000                              787 $LOG     DSECT

 000000                              789          DS    18F                      LINKAGE SAVE AREA

 000048                              791 LOG$I    DS    5F                       @LOGI SAVE AREA
 00005C                              792 LOG$O    DS    5F                       @LOGO SAVE AREA
 000070                              793 LOG$T    DS    5F                       @LOGT SAVE AREA
 000084                              794 LOG$W    DS    5F                       @LOGW SAVE AREA
 000098                              795 LOG$C    DS    5F                       @LOGC SAVE AREA
 0000AC                              796 LOG$Z    DS    5F                       @LOGZ SAVE AREA

 0000C0                              798          DS    0D
 0000C0                              799 LOGWPDBL DS    PL8                      PACKED DOUBLE-WORD

 0000C8                              801 LOG$DCB  DS    F                        DCB ADDR IN @PGM
 0000CC                              802 LOG$FIL  DS    F                        $FIL ADDR
 0000D0                              803 LOGWFDAT DS    F                        DATE SAVE (EEYYJJJ+)

 0000D4                              805 LOGWHYRS DS    H                        BINARY YEAR
 0000D6                              806 LOGWHWRT DS    H                        LOG FILE WRITE RESULT

 0000D8                              808 LOGWCWRK DS    XL16                     '0HHMMSSYYYYNNDDD'

 0000E8                              810          DS    0D                       DOUBLE-WORD ALIGN RECORD
 0000E8                              811 LOGWCREC DS    0CL80                    OUTPUT LOG RECORD
 0000E8                              812 LOGWCYRS DS    CL4                        YEAR
 0000EC                              813 LOGWCDL1 DS    CL1                        '.'
 0000ED                              814 LOGWCMON DS    CL2                        MONTH
 0000EF                              815 LOGWCDL2 DS    CL1                        '.'
 0000F0                              816 LOGWCMDY DS    CL2                        DAY OF MONTH
 0000F2                              817 LOGWCDL3 DS    CL1                        ' '
 0000F3                              818 LOGWCHRS DS    CL2                        HOUR
 0000F5                              819 LOGWCDL4 DS    CL1                        ':'
 0000F6                              820 LOGWCMIN DS    CL2                        MINUTE
 0000F8                              821 LOGWCDL5 DS    CL1                        ':'
 0000F9                              822 LOGWCSEC DS    CL2                        SECOND
 0000FB                              823 LOGWCDL6 DS    CL1                        ' '
 0000FC                              824 LOGWCMSG DS    CL60                       MESSAGE

                             00138   826 E$LOGL   EQU   *-$LOG                   $LOG LENGTH
1                                                                                                               PAGE   27
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    828          COPY  @FIL                     FILE CLASS
                                     829 ***********************************************************************
                                     830 *
                                     831 *        @FIL       FILE FACILITY
                                     832 *
                                     833 *        @FILA      ALLOCATE $FIL STORAGE
                                     834 *        @FILI      INITIALIZE $FIL
                                     835 *        @FILO      OPEN THE FILE
                                     836 *        @FILR      READ FROM THE FILE
                                     837 *        @FILW      WRITE TO THE FILE
                                     838 *        @FILC      CLOSE THE FILE
                                     839 *        @FILZ      RELEASE $FIL STORAGE
                                     840 *
                                     841 *        COPYRIGHT 2010-2021 DAVID J WALLING. MIT LICENSE.
                                     842 *
                                     843 ***********************************************************************
1                                                                                                               PAGE   28
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    845 ***********************************************************************
                                     846 *
                                     847 *        @FIL       FILE CONTROL SECTION
                                     848 *
                                     849 ***********************************************************************

 000470                              851 @FIL     CSECT
1                                                                                                               PAGE   29
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    853 ***********************************************************************
                                     854 *
                                     855 *        @FILA      ALLOCATE STORAGE FOR INSTANCE
                                     856 *
                                     857 *        IN         R10     @FIL CSECT ADDR
                                     858 *                   R12     CALLER CSECT ADDR
                                     859 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     860 *                   R14     RETURN ADDRESS
                                     861 *
                                     862 *        OUT        R1      $FIL ADDR (OR ABEND)
                                     863 *                   R15     GETMAIN RESULT (OR ABEND)
                                     864 *
                                     865 ***********************************************************************

 000470                              867 @FILA    DS    0H

                             00470   869          USING @FIL,R10

 000470 182E                         871          LR    R2,R14                   HOLD RETURN ADDR
 000472 4100 0079      00079         872          LA    R0,E$FILL                $FIL SIZE

                                     874          GETMAIN R,LV=(0)               ALLOCATE STORAGE (,10)
 000476 4510 A00A      0047A         875+         BAL   1,*+4                             INDICATE GETMAIN
 00047A 0A0A                         876+         SVC   10                                ISSUE GETMAIN SVC

 00047C 18E2                         878          LR    R14,R2                   LOAD RETURN ADDR
 00047E 07FE                         879          BR    R14                      RETURN TO CALLER

                                     881          DROP  R10
1                                                                                                               PAGE   30
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    883 ***********************************************************************
                                     884 *
                                     885 *        @FILI      INITIALIZE $FIL CONTEXT
                                     886 *
                                     887 *        IN         R0      DCB OPTION BYTE (BITS 24-31)
                                     888 *                   R1      DCB TEMPLATE ADDR
                                     889 *                   R10     @FIL CSECT ADDR
                                     890 *                   R11     $FIL DSECT ADDR
                                     891 *                   R12     CALLER CSECT ADDR
                                     892 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     893 *                   R14     RETURN ADDRESS
                                     894 *
                                     895 ***********************************************************************

 000480                              897 @FILI    DS    0H

                             00000   899          USING $FIL,R11

 000480 50E0 B000      00000         901          ST    R14,FIL$I                SAVE RETURN ADDR (,11)

 000484 4200 B078      00078         903          STC   R0,FILXOPT               SAVE DCB OPTION BYTE (,11)
 000488 D25F B018 1000 00018 00000   904          MVC   FILXDCB,0(R1)            COPY DCB TEMPLATE (,11)

 00048E 58E0 B000      00000         906          L     R14,FIL$I                LOAD RETURN ADDR (,11)
 000492 07FE                         907          BR    R14                      RETURN TO CALLER

                                     909          DROP  R11
1                                                                                                               PAGE   31
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    911 ***********************************************************************
                                     912 *
                                     913 *        @FILO      OPEN THE FILE
                                     914 *
                                     915 *        IN         R10     @FIL CSECT ADDR
                                     916 *                   R11     $FIL DSECT ADDR
                                     917 *                   R12     CALLER CSECT ADDR
                                     918 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     919 *                   R14     RETURN ADDRESS
                                     920 *
                                     921 *        OUT        R15     OPEN RESULT CODE
                                     922 *
                                     923 ***********************************************************************

 000494                              925 @FILO    DS    0H

                             00000   927          USING $FIL,R11

 000494 50E0 B004      00004         929          ST    R14,FIL$O                SAVE RETURN ADDR (,11)

 000498 4110 B014      00014         931          LA    R1,FILFARG               PARMLIST ADDR (,11)
 00049C 4100 B018      00018         932          LA    R0,FILXDCB               DCB ADDR (,11)
 0004A0 5000 1000      00000         933          ST    R0,0(,R1)                PUT DCB ADDR IN PARMLIST
 0004A4 D200 1000 B078 00000 00078   934          MVC   0(1,R1),FILXOPT          SET HI BYTE TO OPTION

 0004AA 0A13                         936          SVC   19                       ISSUE OPEN

 0004AC 58E0 B004      00004         938          L     R14,FIL$O                LOAD RETURN ADDR (,11)
 0004B0 07FE                         939          BR    R14                      RETURN TO CALLER

                                     941          DROP  R11
1                                                                                                               PAGE   32
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    943 ***********************************************************************
                                     944 *
                                     945 *        @FILR      READ THE FILE
                                     946 *
                                     947 *        IN         R0      TARGET ADDR FOR READ
                                     948 *                   R10     @FIL CSECT ADDR
                                     949 *                   R11     $FIL DSECT ADDR
                                     950 *                   R12     CALLER CSECT ADDR
                                     951 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     952 *                   R14     RETURN ADDRESS
                                     953 *
                                     954 *        OUT        R15     GET RESULT CODE
                                     955 *
                                     956 *        GET ROUTINE MAY USE SAVE AREA AT R13
                                     957 *
                                     958 ***********************************************************************

 0004B2                              960 @FILR    DS    0H

                             00000   962          USING $FIL,R11

 0004B2 50E0 B008      00008         964          ST    R14,FIL$R                SAVE RETURN ADDR (,11)

 0004B6 4110 B018      00018         966          LA    R1,FILXDCB               DCB ADDR (,11)
 0004BA 58F0 1030      00030         967          L     R15,48(,R1)              DCB GET ROUTINE ADDR

 0004BE 05EF                         969          BALR  R14,R15                  CALL GET ROUTINE

 0004C0 58E0 B008      00008         971          L     R14,FIL$R                LOAD RETURN ADDR (,11)
 0004C4 07FE                         972          BR    R14                      RETURN TO CALLER

                                     974          DROP  R11
1                                                                                                               PAGE   33
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                    976 ***********************************************************************
                                     977 *
                                     978 *        @FILW      WRITE TO THE FILE
                                     979 *
                                     980 *        IN         R0      SOURCE ADDR FOR WRITE
                                     981 *                   R10     @FIL CSECT ADDR
                                     982 *                   R11     $FIL DSECT ADDR
                                     983 *                   R12     CALLER CSECT ADDR
                                     984 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                     985 *                   R14     RETURN ADDRESS
                                     986 *
                                     987 *        OUT        R15     PUT RESULT CODE
                                     988 *
                                     989 *        PUT ROUTINE MAY USE SAVE AREA AT 13
                                     990 *
                                     991 ***********************************************************************

 0004C6                              993 @FILW    DS    0H

                             00470   995          USING @FIL,R10
                             00000   996          USING $FIL,R11

 0004C6 50E0 B00C      0000C         998          ST    R14,FIL$W                SAVE RETURN ADDR (,11)

 0004CA 4110 B018      00018        1000          LA    R1,FILXDCB               DCB ADDR (,11)
 0004CE 58F0 1030      00030        1001          L     R15,48(,R1)              DCB PUT ROUTINE ADDR

 0004D2 05EF                        1003          BALR  R14,R15                  CALL PUT ROUTINE

 0004D4 17FF                        1005          XR    R15,R15                  ZERO RESULT IF NO SYNAD

 0004D6                             1007 @FILW80  DS    0H                       SYNAD RETURNS HERE

 0004D6 58E0 B00C      0000C        1009          L     R14,FIL$W                LOAD RETURN ADDR (,11)
 0004DA 07FE                        1010          BR    R14                      RETURN TO CALLER

 0004DC                             1012 @FILWSYN DS    0H                       SYNAD ENTRY

 0004DC 18F1                        1014          LR    R15,R1                   ERROR BITS 0-7
 0004DE 88F0 0018      00018        1015          SRL   R15,24                   ERROR BITS 24-31

 0004E2 47F0 A066      004D6        1017          B     @FILW80                  CONTINUE

                                    1019          DROP  R10,R11
1                                                                                                               PAGE   34
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                   1021 ***********************************************************************
                                    1022 *
                                    1023 *        @FILC      CLOSE THE FILE
                                    1024 *
                                    1025 *        IN         R10     @FIL CSECT ADDR
                                    1026 *                   R11     $FIL DSECT ADDR
                                    1027 *                   R12     CALLER CSECT ADDR
                                    1028 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                    1029 *                   R14     RETURN ADDRESS
                                    1030 *
                                    1031 *        OUT        R15     SVC 20 RESULT CODE
                                    1032 *
                                    1033 ***********************************************************************

 0004E6                             1035 @FILC    DS    0H

                             00000  1037          USING $FIL,R11

 0004E6 50E0 B010      00010        1039          ST    R14,FIL$C                SAVE RETURN ADDR (,11)

 0004EA 4110 B014      00014        1041          LA    R1,FILFARG               PARMLIST ADDR (,11)
 0004EE 4100 B018      00018        1042          LA    R0,FILXDCB               DCB ADDR (,11)
 0004F2 5000 1000      00000        1043          ST    R0,0(,R1)                PUT DCB ADDR IN PARMLIST
 0004F6 9280 1000      00000        1044          MVI   0(R1),X'80'              MARK AS LAST PARM

 0004FA 0A14                        1046          SVC   20                       CLOSE FILE

 0004FC 58E0 B010      00010        1048          L     R14,FIL$C                LOAD RETURN ADDR (,11)
 000500 07FE                        1049          BR    R14                      RETURN TO CALLER

                                    1051          DROP  R11
1                                                                                                               PAGE   35
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                   1053 ***********************************************************************
                                    1054 *
                                    1055 *        @FILZ      FINALIZE $FIL OBJECT
                                    1056 *
                                    1057 *        IN         R10     @FIL CSECT ADDR
                                    1058 *                   R11     $FIL DSECT ADDR
                                    1059 *                   R12     CALLER CSECT ADDR
                                    1060 *                   R13     CALLER DATA ADDR (SAVE AREA)
                                    1061 *                   R14     RETURN ADDRESS
                                    1062 *
                                    1063 *        OUT        R15     FREEMAIN RESULT CODE (OR ABEND)
                                    1064 *
                                    1065 ***********************************************************************

 000502                             1067 @FILZ    DS    0H

                             00470  1069          USING @FIL,R10

 000502 182E                        1071          LR    R2,R14                   HOLD RETURN ADDR
 000504 181B                        1072          LR    R1,R11                   $FIL ADDR
 000506 4100 0079      00079        1073          LA    R0,E$FILL                $FIL LENGTH

                                    1075          FREEMAIN R,LV=(0),A=(1)        RELEASE STORAGE (,10)
                                    1076+*      OS/VS2 RELEASE 3 VERSION  -- 10/25/74                            00001603
 00050A 4110 1000      00000        1077+         LA    1,0(0,1)                          CLEAR HI ORDER BYTE    00150802
 00050E 0A0A                        1078+         SVC   10                                ISSUE FREEMAIN SVC     00311202

 000510 18E2                        1080          LR    R14,R2                   LOAD RETURN ADDR
 000512 07FE                        1081          BR    R14                      RETURN TO CALLER

                                    1083          DROP  R10
1                                                                                                               PAGE   36
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0                                   1085 ***********************************************************************
                                    1086 *
                                    1087 *        W O R K I N G   S T O R A G E
                                    1088 *
                                    1089 ***********************************************************************

                             00080  1091 FILETYPI EQU   X'80'                    INPUT FILE OPTION BYTE
                             0008F  1092 FILETYPO EQU   X'8F'                    OUTPUT FILE OPTION BYTE

                                    1094 ***********************************************************************
                                    1095 *
                                    1096 *        $FIL       FILE DATA SECTION
                                    1097 *
                                    1098 ***********************************************************************

 000000                             1100 $FIL     DSECT

 000000                             1102 FIL$I    DS    F                        @FILI RETURN ADDR
 000004                             1103 FIL$O    DS    F                        @FILO RETURN ADDR
 000008                             1104 FIL$R    DS    F                        @FILR RETURN ADDR
 00000C                             1105 FIL$W    DS    F                        @FILW RETURN ADDR
 000010                             1106 FIL$C    DS    F                        @FILC RETURN ADDR

 000014                             1108 FILFARG  DS    F                        SVC 19,20 INPUT

 000018                             1110          DS    0F                       FULLWORD ALIGN DCB
 000018                             1111 FILXDCB  DS    XL96                     DCB COPY
 000078                             1112 FILXOPT  DS    X                        OPTION BYTE

                             00079  1114 E$FILL   EQU   *-$FIL                   DATA SECTION LENGTH
1                                                                                                               PAGE   37
-  LOC  OBJECT CODE    ADDR1 ADDR2  STMT   SOURCE STATEMENT                                       ASM 0201 23.23 12/17/20
0000000                             1116          END   @PGM                     END OF PROGRAM
1                                                  RELOCATION DICTIONARY                                        PAGE   38
-POS.ID   REL.ID   FLAGS   ADDRESS                                                                ASM 0201 23.23 12/17/20
0 0001     0002      0C     000154
  0001     0003      0C     00019C
  0002     0003      0C     00039C

1                                                  CROSS-REFERENCE                                              PAGE   39
-SYMBOL    LEN   VALUE   DEFN    REFERENCES                                                       ASM 0201 23.23 12/17/20
0$FIL     00001 00000000 01100  00899 00927 00962 00996 01037 01114
 $LOG     00001 00000000 00787  00429 00436 00480 00487 00519 00526 00622 00629 00686 00693 00721 00728 00826
 $PGM     00001 00000000 00340  00029 00090 00157 00196 00350
 @FIL     00001 00000470 00851  00437 00488 00654 00694 00729 00762 00869 00995 01069
 @FILA    00002 00000470 00867  00449
 @FILC    00002 000004E6 01035  00698
 @FILI    00002 00000480 00897  00457
 @FILO    00002 00000494 00925  00492
 @FILR    00002 000004B2 00960
 @FILW    00002 000004C6 00993  00659
 @FILWSYN 00002 000004DC 01012  00314
 @FILW80  00002 000004D6 01007  01017
 @FILZ    00002 00000502 01067  00733
 @FINAL   00002 00000100 00193  00059
 @FINL10  00002 0000012A 00217  00206
 @INIT    00002 00000058 00087  00050
 @INIT10  00002 000000C4 00141  00128
 @LOG     00001 000001C8 00382  00091 00158 00197 00273 00400 00435 00486 00525 00628 00692 00727 00738
 @LOGA    00002 000001C8 00398  00096
 @LOGC    00002 00000358 00684  00203
 @LOGI    00002 000001D8 00427  00112
 @LOGO    00002 00000222 00478  00125
 @LOGT    00002 0000023C 00517  00652
 @LOGT10  00002 000002BE 00568  00563 00565
 @LOGT20  00002 000002C4 00573  00579
 @LOGT30  00002 000002D8 00581  00576
 @LOGT40  00002 000002FC 00594  00542
 @LOGW    00002 00000302 00620  00166
 @LOGW10  00002 0000032E 00645  00642
 @LOGW90  00002 0000034C 00661  00635 00637
 @LOGXWRT 00006 00000352 00666  00648
 @LOGZ    00002 00000372 00719  00221
 @MAIN    00002 000000CA 00154  00055
 @MAIN10  00002 000000FA 00180  00169
 @PGM     00001 00000000 00026  00028 00089 00156 00195 01116
 @PGM10   00002 00000034 00057  00053
 CCLOGMSG 00011 00000158 00275  00162 00163
 DCBLOG   00004 00000164 00281  00109
 E$FILL   00001 00000079 01114  00872 01073
 E$LOGL   00001 00000138 00826  00403 00742
 E$PGML   00001 00000058 00350  00034 00041 00063
 FIL$C    00004 00000010 01106  01039 01048
 FIL$I    00004 00000000 01102  00901 00906
 FIL$O    00004 00000004 01103  00929 00938
 FIL$R    00004 00000008 01104  00964 00971
 FIL$W    00004 0000000C 01105  00998 01009
 FILETYPI 00001 00000080 01091
 FILETYPO 00001 0000008F 01092  00453
 FILFARG  00004 00000014 01108  00931 01041
 FILXDCB  00096 00000018 01111  00904 00932 00966 01000 01042
 FILXOPT  00001 00000078 01112  00903 00934
 IHB0003A 00002 00000078 00106  00102
 IHB0004A 00002 0000009C 00120  00116
 IHB0005A 00002 000000C0 00136  00132
 IHB0006A 00002 000000F8 00177  00173
1                                                  CROSS-REFERENCE                                              PAGE   40
-SYMBOL    LEN   VALUE   DEFN    REFERENCES                                                       ASM 0201 23.23 12/17/20
0IHB0007A 00002 00000128 00214  00210
 IHB0008A 00002 00000148 00229  00225
 LOG$C    00004 00000098 00795  00688 00689 00700
 LOG$DCB  00004 000000C8 00801  00439 00454
 LOG$FIL  00004 000000CC 00802  00451 00456 00491 00658 00697 00732
 LOG$I    00004 00000048 00791  00431 00432 00459
 LOG$O    00004 0000005C 00792  00482 00483 00495
 LOG$T    00004 00000070 00793  00521 00522 00596
 LOG$W    00004 00000084 00794  00624 00625 00663
 LOG$Z    00004 000000AC 00796  00723 00724 00735
 LOG@FIL  00004 0000039C 00762  00448 00455 00490 00657 00696 00731
 LOGCC00  00002 000003A7 00766  00564
 LOGCF15  00004 000003A0 00764  00548
 LOGCPERA 00003 000003A4 00765  00551
 LOGCTMON 00002 000003AA 00768  00561
 LOGEMAXL 00001 0000003C 00760  00640
 LOGWCDL1 00001 000000EC 00813  00441
 LOGWCDL2 00001 000000EF 00815  00442
 LOGWCDL3 00001 000000F2 00817  00443
 LOGWCDL4 00001 000000F5 00819  00444
 LOGWCDL5 00001 000000F8 00821  00445
 LOGWCDL6 00001 000000FB 00823  00446
 LOGWCHRS 00002 000000F3 00818  00537
 LOGWCMDY 00002 000000F0 00816  00591 00592 00592
 LOGWCMIN 00002 000000F6 00820  00538
 LOGWCMON 00002 000000ED 00814  00587 00588 00588
 LOGWCMSG 00060 000000FC 00824  00631 00632 00632 00632 00666
 LOGWCREC 00080 000000E8 00811  00656
 LOGWCSEC 00002 000000F9 00822  00539
 LOGWCWRK 00016 000000D8 00808  00535 00537 00538 00539
 LOGWCYRS 00004 000000E8 00812  00552 00553 00553 00564
 LOGWFDAT 00004 000000D0 00803  00541 00544 00557
 LOGWHWRT 00002 000000D6 00806
 LOGWHYRS 00002 000000D4 00805  00556 00562
 LOGWPDBL 00008 000000C0 00799  00534 00535 00550 00551 00552 00555 00558 00559 00586 00587 00590 00591
 PGM$F    00004 00000050 00346  00199 00234
 PGM$I    00004 00000048 00344  00093 00143
 PGM$LOG  00004 00000054 00348  00098 00111 00124 00165 00202 00220
 PGM$M    00004 0000004C 00345  00160 00182
 PGM@LOG  00004 00000154 00273  00095 00110 00123 00164 00201 00219
 R0       00001 00000000 00256  00034 00063 00069 00075 00162 00403 00453 00534 00546 00546 00550 00558 00570 00579 00634
                                00634 00639 00640 00641 00643 00647 00656 00742 00872 00903 00932 00933 01042 01043 01073
 R1       00001 00000001 00257  00040 00046 00047 00048 00064 00065 00070 00098 00109 00163 00439 00451 00454 00534 00541
                                00544 00547 00548 00550 00555 00556 00557 00558 00559 00575 00577 00590 00636 00636 00666
                                00741 00904 00931 00933 00934 00966 00967 01000 01001 01014 01041 01043 01044 01072
 R10      00001 0000000A 00266  00091 00095 00110 00123 00146 00158 00164 00185 00197 00201 00219 00237 00400 00412 00431
                                00437 00448 00455 00459 00462 00482 00488 00490 00495 00498 00521 00596 00624 00650 00654
                                00657 00663 00668 00688 00694 00696 00700 00703 00723 00729 00731 00735 00737 00738 00752
                                00869 00881 00995 01019 01069 01083
 R11      00001 0000000B 00267  00111 00124 00165 00202 00220 00429 00434 00456 00480 00485 00491 00519 00524 00622 00627
                                00651 00658 00686 00691 00697 00721 00726 00732 00741 00899 00909 00927 00941 00962 00974
                                00996 01019 01037 01051 01072
 R12      00001 0000000C 00268  00028 00031 00032 00075 00079 00089 00146 00156 00185 00195 00237 00432 00435 00462 00483
                                00486 00498 00522 00525 00599 00625 00628 00650 00668 00689 00692 00703 00724 00727 00737
 R13      00001 0000000D 00269  00029 00031 00046 00047 00048 00064 00065 00075 00076 00079 00090 00146 00157 00185 00196
1                                                  CROSS-REFERENCE                                              PAGE   41
-SYMBOL    LEN   VALUE   DEFN    REFERENCES                                                       ASM 0201 23.23 12/17/20
0                               00237 00432 00436 00462 00483 00487 00498 00522 00526 00599 00625 00629 00651 00668 00689
                                00693 00703 00724 00728 00737
 R14      00001 0000000E 00270  00031 00040 00044 00050 00055 00059 00076 00077 00093 00096 00112 00125 00143 00144 00160
                                00166 00182 00183 00199 00203 00221 00234 00235 00402 00409 00410 00431 00449 00457 00459
                                00460 00482 00492 00495 00496 00521 00596 00597 00624 00652 00659 00663 00664 00688 00698
                                00700 00701 00723 00733 00735 00740 00749 00750 00871 00878 00879 00901 00906 00907 00929
                                00938 00939 00964 00969 00971 00972 00998 01003 01009 01010 01039 01048 01049 01071 01080
                                01081
 R15      00001 0000000F 00271  00032 00041 00052 00052 00061 00073 00127 00127 00139 00139 00168 00168 00205 00205 00232
                                00232 00967 00969 01001 01003 01005 01005 01014 01015
 R2       00001 00000002 00258  00042 00042 00043 00044 00061 00073 00402 00409 00571 00571 00575 00577 00578 00578 00583
                                00584 00584 00586 00639 00641 00643 00647 00648 00740 00749 00871 00878 01071 01080
 R3       00001 00000003 00259  00043 00561 00566 00566 00575 00577
 R4       00001 00000004 00260
 R5       00001 00000005 00261
 R6       00001 00000006 00262
 R7       00001 00000007 00263
 R8       00001 00000008 00264
 R9       00001 00000009 00265
1                                                  ASSEMBLER DIAGNOSTICS AND STATISTICS                         PAGE   42
-                                                                                                 ASM 0201 23.23 12/17/20
0NO STATEMENTS FLAGGED IN THIS ASSEMBLY
 HIGHEST SEVERITY WAS    0
 OPTIONS FOR THIS ASSEMBLY
   ALIGN, ALOGIC, BUFSIZE(STD), DECK, ESD, FLAG(0), LINECOUNT(55), LIST, NOMCALL, YFLAG, WORKSIZE(2097152)
   NOMLOGIC, NONUMBER, OBJECT, RENT, RLD, NOSTMT, NOLIBMAC, NOTERMINAL, NOTEST, XREF
   SYSPARM()
 WORK FILE BUFFER SIZE/NUMBER =19066/ 1
 TOTAL RECORDS READ FROM SYSTEM INPUT        235
 TOTAL RECORDS READ FROM SYSTEM LIBRARY     4758
 TOTAL RECORDS PUNCHED                        28
 TOTAL RECORDS PRINTED                      1326
```

### Linker Messages

The linker finds three CSECTs, @PGM, @LOG and @FIL. The program entry is offset 00 into the @PGM CSECT. The module is reentrant and reusable. There are two relocation addresses resolved at link time that correspond to the two address constants (ADCON), "PGM@LOG DC A(@LOG)" and "LOG@FIL DC A(@FIL)".
```
 F64-LEVEL LINKAGE EDITOR OPTIONS SPECIFIED XREF,LET,LIST,NCAL,RENT                                                  
          DEFAULT OPTION(S) USED -  SIZE=(229376,55296)                                                              
                                                                                                                     
                                                CROSS REFERENCE TABLE                                                
                                                                                                                     
  CONTROL SECTION                       ENTRY                                                                        
    NAME    ORIGIN  LENGTH                NAME   LOCATION     NAME   LOCATION     NAME   LOCATION     NAME   LOCATION
  @PGM          00     1C8                                                                                           
  @LOG         1C8     2A2                                                                                           
  @FIL         470      A4                                                                                           
                                                                                                                     
                                                                                                                     
  LOCATION  REFERS TO SYMBOL  IN CONTROL SECTION             LOCATION  REFERS TO SYMBOL  IN CONTROL SECTION          
      154            @LOG            @LOG                         19C            @FIL            @FIL                
      39C            @FIL            @FIL                                                                            
 ENTRY ADDRESS       00                                                                                              
 TOTAL LENGTH       518                                                                                              
****ASM006    NOW REPLACED IN DATA SET                                                                               
AUTHORIZATION CODE IS         0.                                                                                     
**MODULE HAS BEEN MARKED REENTERABLE, AND REUSABLE.                                                                  
```     

### Operator Console Output

Program progress notifcations are written to the operator console using the WTO macro.
```
23.23.08 JOB  156  $HASP100 ASM006   ON INTRDR      DWALL01
23.23.08 JOB  156  $HASP373 ASM006   STARTED - INIT  1 - CLASS A - SYS HMVS
23.23.08 JOB  156  IEF403I ASM006 - STARTED - TIME=23.23.08
23.23.11 JOB  156  IEFACTRT ASM     /IFOX00  /00:00:02.49/00:00:03.11/00000/ASM006
23.23.12 JOB  156  IEFACTRT LINK    /IEWL    /00:00:00.13/00:00:00.34/00000/ASM006
23.23.12 JOB  156  +@LOGA OK
23.23.12 JOB  156  +@LOGI OK
23.23.12 JOB  156  +@LOGO OK
23.23.12 JOB  156  +@LOGW OK
23.23.12 JOB  156  +@LOGC OK
23.23.12 JOB  156  +@LOGZ OK
23.23.12 JOB  156  IEFACTRT RUN     /ASM006  /00:00:00.08/00:00:00.45/00000/ASM006
23.23.12 JOB  156  IEF404I ASM006 - ENDED - TIME=23.23.12
23.23.12 JOB  156  $HASP395 ASM006   ENDED
23.23.12           $HASP309    INIT  1 INACTIVE ******** C=A
23.23.13 JOB  156  $HASP150 ASM006   ON PUNCH1          28 CARDS
23.23.13 JOB  156  $HASP150 ASM006   ON PRINTER1       184 LINES
23.23.13           $HASP160 PUNCH1   INACTIVE - CLASS=B
23.23.13           $HASP160 PRINTER1 INACTIVE - CLASS=A
23.23.13 JOB  156  $HASP250 ASM006   IS PURGED
```

### Output Log File (GDG Generation)

Note the date and time formatted into the log record by the @LOGT method and then written to the GDG by the @LOGW and @FILW methods.
```
 View DWALL01.GDG.LOG.G0023V00--------------------------------------------------
 Cmd =>                                                                         
----+----1----+----2----+----3----+----4----+----5----+----6----+----7----+----8
2020.12.17 23:23:12 LOG MESSAGE                                                 
```

<hr>

Return to [Sample Programs](Samples.md)  
Return to [README](../README.md)
